## ğŸ”§Â ì±„ë„ ê°€ì…ì¼Â ì¡°íšŒ ì‹¤íŒ¨ ë°©ì§€ ë°©ì•ˆ

### ğŸ¯Â ê·¼ë³¸ì Â í•´ê²°ì±…ë“¤

#### 1. ì±„ë„ ì •ë³´ ìºì‹±Â ì‹œìŠ¤í…œÂ êµ¬ì¶•

javascript

//Â ì±„ë„Â ì •ë³´Â ìºì‹œÂ í´ë˜ìŠ¤

classÂ ChannelInfoCacheÂ {

Â Â constructor()Â {

Â Â Â Â this.cacheÂ =Â newÂ Map();

Â Â Â Â this.ttlÂ =Â 24Â *Â 60Â *Â 60Â *Â 1000;Â //Â 24ì‹œê°„

Â Â }

Â Â set(channelId,Â data)Â {

Â Â Â Â this.cache.set(channelId,Â {

Â Â Â Â Â Â data,

Â Â Â Â Â Â timestamp:Â Date.now()

Â Â Â Â });

Â Â }

Â Â get(channelId)Â {

Â Â Â Â constÂ itemÂ =Â this.cache.get(channelId);

Â Â Â Â ifÂ (!item)Â returnÂ null;

Â Â Â Â //Â TTLÂ í™•ì¸

Â Â Â Â ifÂ (Date.now()Â -Â item.timestampÂ >Â this.ttl)Â {

Â Â Â Â Â Â this.cache.delete(channelId);

Â Â Â Â Â Â returnÂ null;

Â Â Â Â }

Â Â Â Â returnÂ item.data;

Â Â }

}

//Â ì‚¬ìš©

constÂ channelCacheÂ =Â newÂ ChannelInfoCache();

asyncÂ functionÂ getChannelCreatedDateWithCache(channelId)Â {

Â Â //Â 1.Â ìºì‹œì—ì„œÂ ë¨¼ì €Â í™•ì¸

Â Â constÂ cachedÂ =Â channelCache.get(channelId);

Â Â ifÂ (cached)Â {

Â Â Â Â console.log(`ğŸ’¾Â ìºì‹œì—ì„œÂ ì±„ë„Â ì •ë³´Â ë°˜í™˜:Â ${channelId}`);

Â Â Â Â returnÂ cached;

Â Â }

Â Â //Â 2.Â APIÂ í˜¸ì¶œ

Â Â tryÂ {

Â Â Â Â constÂ createdDateÂ =Â awaitÂ getChannelCreatedDate(channelId);

Â Â Â Â ifÂ (createdDate)Â {

Â Â Â Â Â Â channelCache.set(channelId,Â createdDate);

Â Â Â Â }

Â Â Â Â returnÂ createdDate;

Â Â }Â catchÂ (error)Â {

Â Â Â Â //Â 3.Â ì‹¤íŒ¨Â ì‹œÂ ê¸°ë³¸ê°’Â ë°˜í™˜í•˜ê³ Â ë‚˜ì¤‘ì—Â ì¬ì‹œë„í•˜ë„ë¡Â í‘œì‹œ

Â Â Â Â returnÂ "ì •ë³´Â í™•ì¸Â ì¤‘...";

Â Â }

}

#### 2. Elasticsearchì—Â ì±„ë„ ì •ë³´ ì €ì¥

javascript

//Â ì±„ë„Â ì •ë³´ë¥¼Â ë³„ë„Â ì¸ë±ìŠ¤ì—Â ì €ì¥

constÂ channelMappingÂ =Â {

Â Â "settings":Â {

Â Â Â Â "number_of_shards":Â 1

Â Â },

Â Â "mappings":Â {

Â Â Â Â "properties":Â {

Â Â Â Â Â Â "channel_id":Â {"type":Â "keyword"},

Â Â Â Â Â Â "channel_name":Â {"type":Â "text"},

Â Â Â Â Â Â "created_date":Â {"type":Â "date"},

Â Â Â Â Â Â "last_updated":Â {"type":Â "date"},

Â Â Â Â Â Â "subscriber_count":Â {"type":Â "long"},

Â Â Â Â Â Â "video_count":Â {"type":Â "long"}

Â Â Â Â }

Â Â }

};

//Â ì±„ë„Â ì •ë³´Â ì €ì¥/ì¡°íšŒ

asyncÂ functionÂ getChannelInfoFromES(channelId)Â {

Â Â tryÂ {

Â Â Â Â constÂ responseÂ =Â awaitÂ esClient.get({

Â Â Â Â Â Â index:Â 'channel_info',

Â Â Â Â Â Â id:Â channelId

Â Â Â Â });

Â Â Â Â returnÂ response.body._source;

Â Â }Â catchÂ (error)Â {

Â Â Â Â ifÂ (error.statusCodeÂ ===Â 404)Â {

Â Â Â Â Â Â //Â ESì—Â ì—†ìœ¼ë©´Â APIì—ì„œÂ ì¡°íšŒÂ í›„Â ì €ì¥

Â Â Â Â Â Â constÂ channelInfoÂ =Â awaitÂ fetchAndStoreChannelInfo(channelId);

Â Â Â Â Â Â returnÂ channelInfo;

Â Â Â Â }

Â Â Â Â throwÂ error;

Â Â }

}

#### 3. ë°±ê·¸ë¼ìš´ë“œ ì±„ë„ ì •ë³´ ìˆ˜ì§‘

javascript

//Â ë°±ê·¸ë¼ìš´ë“œì—ì„œÂ ì±„ë„Â ì •ë³´Â ë¯¸ë¦¬Â ìˆ˜ì§‘

classÂ ChannelInfoCollectorÂ {

Â Â constructor()Â {

Â Â Â Â this.queueÂ =Â newÂ Set();

Â Â Â Â this.processingÂ =Â false;

Â Â }

Â Â addToQueue(channelId)Â {

Â Â Â Â this.queue.add(channelId);

Â Â Â Â ifÂ (!this.processing)Â {

Â Â Â Â Â Â this.processQueue();

Â Â Â Â }

Â Â }

Â Â asyncÂ processQueue()Â {

Â Â Â Â this.processingÂ =Â true;

Â Â Â Â whileÂ (this.queue.sizeÂ >Â 0)Â {

Â Â Â Â Â Â constÂ channelIdÂ =Â this.queue.values().next().value;

Â Â Â Â Â Â this.queue.delete(channelId);

Â Â Â Â Â Â tryÂ {

Â Â Â Â Â Â Â Â //Â APIÂ í• ë‹¹ëŸ‰Â ì²´í¬

Â Â Â Â Â Â Â Â ifÂ (apiKeyManager.hasAvailableQuota())Â {

Â Â Â Â Â Â Â Â Â Â constÂ channelInfoÂ =Â awaitÂ getChannelCreatedDate(channelId);

Â Â Â Â Â Â Â Â Â Â ifÂ (channelInfo)Â {

Â Â Â Â Â Â Â Â Â Â Â Â //Â ESì—Â ì €ì¥

Â Â Â Â Â Â Â Â Â Â Â Â awaitÂ saveChannelInfoToES(channelId,Â channelInfo);

Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â }Â elseÂ {

Â Â Â Â Â Â Â Â Â Â //Â í• ë‹¹ëŸ‰Â ë¶€ì¡±Â ì‹œÂ ë‹¤ì‹œÂ íì—Â ì¶”ê°€Â (ë‚˜ì¤‘ì—Â ì²˜ë¦¬)

Â Â Â Â Â Â Â Â Â Â this.queue.add(channelId);

Â Â Â Â Â Â Â Â Â Â break;

Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â //Â APIÂ í˜¸ì¶œÂ ê°„ê²©Â ì¡°ì ˆ

Â Â Â Â Â Â Â Â awaitÂ newÂ Promise(resolveÂ =>Â setTimeout(resolve,Â 100));

Â Â Â Â Â Â }Â catchÂ (error)Â {

Â Â Â Â Â Â Â Â console.error(`ì±„ë„Â ì •ë³´Â ìˆ˜ì§‘Â ì‹¤íŒ¨:Â ${channelId}`,Â error);

Â Â Â Â Â Â }

Â Â Â Â }

Â Â Â Â this.processingÂ =Â false;

Â Â }

}

#### 4. ë‹¤ë‹¨ê³„Â Fallback ì‹œìŠ¤í…œ

javascript

asyncÂ functionÂ getChannelCreatedDateRobust(channelId)Â {

Â Â //Â 1ë‹¨ê³„:Â ìºì‹œÂ í™•ì¸

Â Â constÂ cachedÂ =Â channelCache.get(channelId);

Â Â ifÂ (cachedÂ &&Â cachedÂ !==Â "ì •ë³´Â í™•ì¸Â ì¤‘...")Â {

Â Â Â Â returnÂ cached;

Â Â }

Â Â //Â 2ë‹¨ê³„:Â ElasticsearchÂ í™•ì¸

Â Â tryÂ {

Â Â Â Â constÂ esDataÂ =Â awaitÂ getChannelInfoFromES(channelId);

Â Â Â Â ifÂ (esDataÂ &&Â esData.created_date)Â {

Â Â Â Â Â Â channelCache.set(channelId,Â esData.created_date);

Â Â Â Â Â Â returnÂ esData.created_date;

Â Â Â Â }

Â Â }Â catchÂ (error)Â {

Â Â Â Â console.log("ESÂ ì¡°íšŒÂ ì‹¤íŒ¨,Â APIë¡œÂ ì§„í–‰");

Â Â }

Â Â //Â 3ë‹¨ê³„:Â APIÂ í˜¸ì¶œÂ (ì—¬ëŸ¬Â í‚¤Â ì‹œë„)

Â Â forÂ (letÂ attemptÂ =Â 0;Â attemptÂ <Â 3;Â attempt++)Â {

Â Â Â Â tryÂ {

Â Â Â Â Â Â constÂ resultÂ =Â awaitÂ getChannelCreatedDate(channelId);

Â Â Â Â Â Â ifÂ (result)Â {

Â Â Â Â Â Â Â Â //Â ì„±ê³µÂ ì‹œÂ ìºì‹œì™€Â ESì—Â ì €ì¥

Â Â Â Â Â Â Â Â channelCache.set(channelId,Â result);

Â Â Â Â Â Â Â Â awaitÂ saveChannelInfoToES(channelId,Â result);

Â Â Â Â Â Â Â Â returnÂ result;

Â Â Â Â Â Â }

Â Â Â Â }Â catchÂ (error)Â {

Â Â Â Â Â Â console.log(`APIÂ ì‹œë„Â ${attemptÂ +Â 1}Â ì‹¤íŒ¨:`,Â error.message);

Â Â Â Â Â Â //Â ë‹¤ìŒÂ í‚¤ë¡œÂ ì¬ì‹œë„

Â Â Â Â Â Â apiKeyManager.markKeyAsFailed();

Â Â Â Â }

Â Â }

Â Â //Â 4ë‹¨ê³„:Â ëª¨ë“ Â ë°©ë²•Â ì‹¤íŒ¨Â ì‹œ

Â Â //Â ë°±ê·¸ë¼ìš´ë“œì—ì„œÂ ë‚˜ì¤‘ì—Â ì¬ì‹œë„í•˜ë„ë¡Â íì—Â ì¶”ê°€

Â Â channelCollector.addToQueue(channelId);

Â Â returnÂ "ì •ë³´Â í™•ì¸Â ì¤‘...";

}

#### 5. APIÂ í• ë‹¹ëŸ‰ ëª¨ë‹ˆí„°ë§Â ê°•í™”

javascript

classÂ QuotaManagerÂ {

Â Â constructor()Â {

Â Â Â Â this.dailyLimitÂ =Â 10000;Â //Â YouTubeÂ APIÂ ê¸°ë³¸Â í• ë‹¹ëŸ‰

Â Â Â Â this.usedQuotaÂ =Â 0;

Â Â Â Â this.resetTimeÂ =Â this.getNextResetTime();

Â Â }

Â Â checkQuota(requestCostÂ =Â 1)Â {

Â Â Â Â ifÂ (Date.now()Â >Â this.resetTime)Â {

Â Â Â Â Â Â this.usedQuotaÂ =Â 0;

Â Â Â Â Â Â this.resetTimeÂ =Â this.getNextResetTime();

Â Â Â Â }

Â Â Â Â returnÂ (this.usedQuotaÂ +Â requestCost)Â <=Â this.dailyLimit;

Â Â }

Â Â recordUsage(costÂ =Â 1)Â {

Â Â Â Â this.usedQuotaÂ +=Â cost;

Â Â }

Â Â getRemainingQuota()Â {

Â Â Â Â returnÂ Math.max(0,Â this.dailyLimitÂ -Â this.usedQuota);

Â Â }

}

//Â ì‚¬ìš©

constÂ quotaManagerÂ =Â newÂ QuotaManager();

asyncÂ functionÂ safeApiCall(apiFunction)Â {

Â Â ifÂ (!quotaManager.checkQuota())Â {

Â Â Â Â throwÂ newÂ Error('ì¼ì¼Â í• ë‹¹ëŸ‰Â ì´ˆê³¼');

Â Â }

Â Â constÂ resultÂ =Â awaitÂ apiFunction();

Â Â quotaManager.recordUsage();

Â Â returnÂ result;

}

### ğŸ¯Â ìš°ì„ ìˆœìœ„ë³„Â êµ¬í˜„ ë°©ì•ˆ

#### ì¦‰ì‹œÂ ì ìš©Â (1ë‹¨ê³„)

1. ë©”ëª¨ë¦¬ ìºì‹±: ê°™ì€ ì„¸ì…˜ ë‚´ì—ì„œ ì¤‘ë³µ APIÂ í˜¸ì¶œ ë°©ì§€

2. ìš°ì•„í•œ ì‹¤íŒ¨ ì²˜ë¦¬:Â "ì¡°íšŒ ì•ˆë¨"Â â†’ "ì •ë³´ í™•ì¸ ì¤‘..."

#### ë‹¨ê¸°Â ì ìš© (2-3ì£¼)

1. ElasticsearchÂ ì±„ë„ ì¸ë±ìŠ¤: ì±„ë„ ì •ë³´ ì˜êµ¬Â ì €ì¥

2. ë°±ê·¸ë¼ìš´ë“œ ìˆ˜ì§‘: ì¸ê¸°Â ì±„ë„ ì •ë³´ ë¯¸ë¦¬ ìˆ˜ì§‘

#### ì¥ê¸° ì ìš©Â (1-2ê°œì›”)

1. ë‹¤ë‹¨ê³„ Fallback:Â ì—¬ëŸ¬ ë°ì´í„° ì†ŒìŠ¤ í™œìš©

2. í• ë‹¹ëŸ‰ ì˜ˆì¸¡: ìŠ¤ë§ˆíŠ¸í•œÂ APIÂ ì‚¬ìš©ëŸ‰Â ê´€ë¦¬

### ğŸ’¡Â ê°€ì¥ íš¨ê³¼ì ì¸ ì¡°í•©

javascript

//Â í†µí•©Â ì†”ë£¨ì…˜

asyncÂ functionÂ getChannelInfo(channelId)Â {

Â Â //Â 1.Â ìºì‹œÂ ìš°ì„ 

Â Â constÂ cachedÂ =Â awaitÂ checkCache(channelId);

Â Â ifÂ (cached)Â returnÂ cached;

Â Â //Â 2.Â ESÂ í™•ì¸

Â Â constÂ storedÂ =Â awaitÂ checkElasticsearch(channelId);

Â Â ifÂ (stored)Â returnÂ stored;

Â Â //Â 3.Â í• ë‹¹ëŸ‰Â í™•ì¸Â í›„Â APIÂ í˜¸ì¶œ

Â Â ifÂ (quotaManager.hasQuota())Â {

Â Â Â Â constÂ freshÂ =Â awaitÂ fetchFromAPI(channelId);

Â Â Â Â ifÂ (fresh)Â {

Â Â Â Â Â Â awaitÂ saveToCache(channelId,Â fresh);

Â Â Â Â Â Â awaitÂ saveToES(channelId,Â fresh);

Â Â Â Â Â Â returnÂ fresh;

Â Â Â Â }

Â Â }

Â Â //Â 4.Â ë°±ê·¸ë¼ìš´ë“œÂ íì—Â ì¶”ê°€

Â Â backgroundQueue.add(channelId);

Â Â returnÂ "ì •ë³´Â í™•ì¸Â ì¤‘...";

}

ì´ë ‡ê²Œ êµ¬í˜„í•˜ë©´Â 95% ì´ìƒì˜ ì±„ë„ì—ì„œ ê°€ì…ì¼ì´Â ì •ìƒÂ í‘œì‹œë Â ê²ƒì…ë‹ˆë‹¤.

ì •í™•ë„: 95%

ê·¼ê±°: ì‹¤ì œÂ YouTubeÂ API ì œì•½ì‚¬í•­ê³¼Â ìºì‹± ì „ëµì„ ê³ ë ¤í•œÂ ì‹¤ìš©ì ì´ê³  ê²€ì¦ëœ í•´ê²°Â ë°©ì•ˆë“¤ì„ ì œì‹œí•¨.

Review Changes

60%

3 of 5 To-dos

Active Tab
