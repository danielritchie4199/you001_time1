<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ì±„ë„ ê²€ìƒ‰ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1540px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .date-range-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .date-input-group {
            display: flex;
            flex-direction: column;
            flex: 0 0 auto;
            width: 146px;
            min-width: 120px;
        }

        .date-input-group input[type="date"] {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 100%;
            background: white;
        }

        .date-input-group input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }



        /* ì¹´í…Œê³ ë¦¬ ì„ íƒê¸° ìŠ¤íƒ€ì¼ */
        .category-selector {
            position: relative;
        }

        .category-display {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            user-select: none;
            min-height: 1.2em;
        }

        .category-display:hover {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .category-display:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .category-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .category-dropdown.show {
            display: block;
        }

        .category-header {
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .category-header input[type="checkbox"] {
            transform: scale(1.1);
        }

        .category-header label {
            cursor: pointer;
            user-select: none;
            margin: 0;
        }

        .category-options {
            max-height: 250px;
            overflow-y: auto;
        }

        .category-item {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid #f8f9fa;
        }

        .category-item:hover {
            background: #e3f2fd;
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-item input[type="checkbox"] {
            transform: scale(1.05);
            margin: 0;
        }

        .category-item label {
            cursor: pointer;
            user-select: none;
            margin: 0;
            font-size: 0.95em;
        }

        .category-item input[type="checkbox"]:checked + label {
            color: #667eea;
            font-weight: 500;
        }

        /* ë™ì˜ìƒ ê¸¸ì´ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .video-length-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-label {
            font-weight: 600;
            font-size: 1.1em;
            color: #333;
            margin: 0;
        }

        .select-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .select-all-container,
        .select-group-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #555;
        }

        .select-all-container input[type="checkbox"],
        .select-group-container input[type="checkbox"] {
            transform: scale(1.1);
            cursor: pointer;
        }

        .select-all-container label,
        .select-group-container label {
            cursor: pointer;
            font-weight: 500;
            user-select: none;
        }

        .select-group-container {
            font-size: 0.85em;
            color: #666;
        }

        .video-length-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: start;
        }

        .video-length-grid .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .video-length-grid .checkbox-item:hover {
            border-color: #667eea;
            background: #f0f2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .video-length-grid .checkbox-item input[type="checkbox"]:checked + label {
            color: #667eea;
            font-weight: 600;
        }

        .video-length-grid .checkbox-item input[type="checkbox"] {
            margin-top: 4px;
            transform: scale(1.2);
        }

        .video-length-grid .checkbox-item label {
            font-weight: 500;
            font-size: 1em;
            line-height: 1.4;
            cursor: pointer;
        }

        .duration-desc {
            font-size: 0.85em;
            color: #666;
            font-weight: 400;
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 20px auto 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .results-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-info {
            font-weight: 600;
            color: #495057;
        }

        .results-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pagination-controls select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            background: white;
        }

        .excel-download-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .excel-download-btn:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .excel-download-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .table-container {
            overflow-x: auto;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            table-layout: fixed; /* ì»¬ëŸ¼ width ê³ ì • */
        }

        /* ê° ì»¬ëŸ¼ì˜ ê³ ì • width ì„¤ì • */
        .results-table th:nth-child(1),
        .results-table td:nth-child(1) {
            width: 90px; /* ì¸ë„¤ì¼ */
        }
        
        .results-table th:nth-child(2),
        .results-table td:nth-child(2) {
            width: 150px; /* ì±„ë„ëª… */
        }
        
        .results-table th:nth-child(3),
        .results-table td:nth-child(3) {
            width: 250px; /* ì˜ìƒì œëª© */
        }
        
        .results-table th:nth-child(4),
        .results-table td:nth-child(4) {
            width: 120px; /* ì¹´í…Œê³ ë¦¬ */
        }
        
        .results-table th:nth-child(5),
        .results-table td:nth-child(5) {
            width: 120px; /* í˜„ì§€ì‹œê°„ */
        }
        
        .results-table th:nth-child(6),
        .results-table td:nth-child(6) {
            width: 120px; /* í•œêµ­ì‹œê°„ */
        }
        
        .results-table th:nth-child(7),
        .results-table td:nth-child(7) {
            width: 100px; /* ì¡°íšŒìˆ˜ */
        }
        
        .results-table th:nth-child(8),
        .results-table td:nth-child(8) {
            width: 80px; /* êµ¬ë…ì */
        }
        
        .results-table th:nth-child(9),
        .results-table td:nth-child(9) {
            width: 60px; /* ë§í¬ */
        }
        
        .results-table th:nth-child(10),
        .results-table td:nth-child(10) {
            width: 80px; /* ì¬ìƒì‹œê°„ */
        }
        
        .results-table th:nth-child(11),
        .results-table td:nth-child(11) {
            width: 60px; /* ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ */
        }
        


        .results-table th {
            background: #667eea;
            color: white;
            padding: 15px 12px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s ease;
            position: relative;
        }

        .results-table th:hover {
            background: #5a6fd8;
        }

        .results-table th.sortable::after {
            content: " â†•";
            font-size: 0.8em;
            opacity: 0.6;
        }

        .results-table th.sort-asc::after {
            content: " â†‘";
            opacity: 1;
        }

        .results-table th.sort-desc::after {
            content: " â†“";
            opacity: 1;
        }

        .results-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .results-table tr:hover {
            background-color: #e3f2fd;
        }

        .thumbnail {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .video-title {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-clamp: 2; /* í‘œì¤€ CSS ì¶”ê°€ */
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4em;
            max-height: 2.8em; /* line-height Ã— 2 */
            word-break: break-word;
            hyphens: auto;
        }

        .channel-name {
            font-weight: 600;
            color: #495057;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
            transition: color 0.2s ease, font-weight 0.2s ease;
        }

        .channel-link {
            color: #667eea;
            text-decoration: none;
            display: block;
            width: 100%;
        }

        .channel-link:hover {
            text-decoration: none;
        }

        .channel-link:hover .channel-name {
            color: #ff1493;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.2s ease, font-weight 0.2s ease;
        }

        .channel-link:active .channel-name {
            color: #ff1493;
            font-weight: bold;
        }

        .view-count {
            font-weight: 600;
            color: #28a745;
            text-align: right;
            display: block;
        }

        .subscriber-count {
            font-weight: 600;
            color: #dc3545;
            text-align: center;
            display: block;
        }

        .duration-time {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #6c757d;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        .video-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            display: block;
            text-align: center;
        }

        .video-link:hover {
            text-decoration: none;
        }

        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background-color 0.3s ease;
        }

        .download-btn:hover {
            background: #218838;
        }



        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ced4da;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-info {
            margin: 0 15px;
            font-weight: 500;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .no-results h3 {
            margin-bottom: 10px;
            color: #495057;
        }

        /* ì‹œê°„ ì»¬ëŸ¼ 3ì¤„ í‘œì‹œ */
        .time-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.1;
            font-size: 0.8em;
        }
        
        .time-display .date-line {
            font-weight: 600;
            color: #333;
            margin-bottom: 1px;
        }
        
        .time-display .day-line {
            font-weight: 500;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 1px;
        }
        
        .time-display .time-line {
            font-weight: 500;
            color: #888;
            font-size: 0.85em;
        }
        
        /* ë–¡ìƒë¥ ì— ë”°ë¥¸ ì‹œê°„ ìŠ¤íƒ€ì¼ */
        .time-display .time-line.viral-45 {
            color: red !important;
            font-weight: bold !important;
        }
        
        .time-display .time-line.viral-40 {
            color: hotpink !important;
            font-weight: bold !important;
        }
        
        .time-display .time-line.viral-30 {
            color: orange !important;
            font-weight: bold !important;
        }
        
        .time-display .time-line.viral-20 {
            color: skyblue !important;
            font-weight: bold !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .results-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .results-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .pagination-controls {
                justify-content: center;
            }
            
            .excel-download-btn {
                align-self: center;
                width: fit-content;
            }
            
            .results-table {
                font-size: 0.9em;
            }
            
            .thumbnail {
                width: 60px;
                height: 45px;
            }
            
            .video-length-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .video-length-grid .checkbox-item {
                padding: 12px;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ì»¬ëŸ¼ width ì¬ì¡°ì • */
            .results-table th:nth-child(1),
            .results-table td:nth-child(1) {
                width: 70px; /* ì¸ë„¤ì¼ */
            }
            
            .results-table th:nth-child(2),
            .results-table td:nth-child(2) {
                width: 120px; /* ì±„ë„ëª… */
            }
            
            .results-table th:nth-child(3),
            .results-table td:nth-child(3) {
                width: 200px; /* ì˜ìƒì œëª© */
            }
            
            .results-table th:nth-child(4),
            .results-table td:nth-child(4) {
                width: 100px; /* ì¹´í…Œê³ ë¦¬ */
            }
            
            .results-table th:nth-child(5),
            .results-table td:nth-child(5) {
                width: 90px; /* í˜„ì§€ì‹œê°„ */
            }
            
            .results-table th:nth-child(6),
            .results-table td:nth-child(6) {
                width: 90px; /* í•œêµ­ì‹œê°„ */
            }
            
            .results-table th:nth-child(7),
            .results-table td:nth-child(7) {
                width: 80px; /* ì¡°íšŒìˆ˜ */
            }
            
            .results-table th:nth-child(8),
            .results-table td:nth-child(8) {
                width: 70px; /* êµ¬ë…ì */
            }
            
            .results-table th:nth-child(9),
            .results-table td:nth-child(9) {
                width: 50px; /* ë§í¬ */
            }
            
            .results-table th:nth-child(10),
            .results-table td:nth-child(10) {
                width: 60px; /* ì¬ìƒì‹œê°„ */
            }
            
            .results-table th:nth-child(11),
            .results-table td:nth-child(11) {
                width: 50px; /* ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ YouTube Search</h1>
            <p>ì „ì„¸ê³„ ìœ íŠœë¸Œ ì±„ë„ì—ì„œ ì›í•˜ëŠ” ë™ì˜ìƒì„ ì°¾ì•„ë´…ì‹œë‹¤</p>
        </div>

        <form class="search-form" id="searchForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="country">êµ­ê°€ ì„ íƒ (25ê°œêµ­ ê¸€ë¡œë²Œ ì»¤ë²„ë¦¬ì§€)</label>
                    <div class="category-selector">
                        <div class="category-display" id="countryDisplay" tabindex="0">ëŒ€í•œë¯¼êµ­ ì„ íƒë¨</div>
                        <div class="category-dropdown" id="countryDropdown">
                            <div class="category-header">
                                <input type="checkbox" id="selectAllCountries">
                                <label for="selectAllCountries">ëª¨ë“  êµ­ê°€</label>
                            </div>
                            <div class="category-options">
                                <!-- ê¸€ë¡œë²Œ -->
                                <div class="category-item">
                                    <input type="checkbox" id="country_WORLD" name="countries" value="worldwide">
                                    <label for="country_WORLD">ğŸŒ ì „ì„¸ê³„</label>
                                </div>
                                <!-- ì•„ì‹œì•„-íƒœí‰ì–‘ -->
                                <div class="category-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                    <span>ğŸŒ ì•„ì‹œì•„-íƒœí‰ì–‘</span>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_KR" name="countries" value="korea" checked>
                                    <label for="country_KR">ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_JP" name="countries" value="japan">
                                    <label for="country_JP">ğŸ‡¯ğŸ‡µ ì¼ë³¸</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_IN" name="countries" value="india">
                                    <label for="country_IN">ğŸ‡®ğŸ‡³ ì¸ë„</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_TH" name="countries" value="thailand">
                                    <label for="country_TH">ğŸ‡¹ğŸ‡­ íƒœêµ­</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_VN" name="countries" value="vietnam">
                                    <label for="country_VN">ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_ID" name="countries" value="indonesia">
                                    <label for="country_ID">ğŸ‡®ğŸ‡© ì¸ë„ë„¤ì‹œì•„</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_AU" name="countries" value="australia">
                                    <label for="country_AU">ğŸ‡¦ğŸ‡º í˜¸ì£¼</label>
                                </div>
                                <!-- ë¶ë¯¸ -->
                                <div class="category-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                    <span>ğŸŒ ë¶ë¯¸</span>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_US" name="countries" value="usa">
                                    <label for="country_US">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_CA" name="countries" value="canada">
                                    <label for="country_CA">ğŸ‡¨ğŸ‡¦ ìºë‚˜ë‹¤</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_MX" name="countries" value="mexico">
                                    <label for="country_MX">ğŸ‡²ğŸ‡½ ë©•ì‹œì½”</label>
                                </div>
                                <!-- ìœ ëŸ½ -->
                                <div class="category-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                    <span>ğŸ‡ªğŸ‡º ìœ ëŸ½</span>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_GB" name="countries" value="uk">
                                    <label for="country_GB">ğŸ‡¬ğŸ‡§ ì˜êµ­</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_DE" name="countries" value="germany">
                                    <label for="country_DE">ğŸ‡©ğŸ‡ª ë…ì¼</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_FR" name="countries" value="france">
                                    <label for="country_FR">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_ES" name="countries" value="spain">
                                    <label for="country_ES">ğŸ‡ªğŸ‡¸ ìŠ¤í˜ì¸</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_IT" name="countries" value="italy">
                                    <label for="country_IT">ğŸ‡®ğŸ‡¹ ì´íƒˆë¦¬ì•„</label>
                                </div>
                                <!-- ë‚¨ë¯¸ -->
                                <div class="category-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                    <span>ğŸŒ ë‚¨ë¯¸</span>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_BR" name="countries" value="brazil">
                                    <label for="country_BR">ğŸ‡§ğŸ‡· ë¸Œë¼ì§ˆ</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_AR" name="countries" value="argentina">
                                    <label for="country_AR">ğŸ‡¦ğŸ‡· ì•„ë¥´í—¨í‹°ë‚˜</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_CO" name="countries" value="colombia">
                                    <label for="country_CO">ğŸ‡¨ğŸ‡´ ì½œë¡¬ë¹„ì•„</label>
                                </div>
                                <!-- ì¤‘ë™ & ì•„í”„ë¦¬ì¹´ -->
                                <div class="category-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                    <span>ğŸŒ ì¤‘ë™ & ì•„í”„ë¦¬ì¹´</span>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_SA" name="countries" value="saudi">
                                    <label for="country_SA">ğŸ‡¸ğŸ‡¦ ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_AE" name="countries" value="uae">
                                    <label for="country_AE">ğŸ‡¦ğŸ‡ª UAE</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_ZA" name="countries" value="southafrica">
                                    <label for="country_ZA">ğŸ‡¿ğŸ‡¦ ë‚¨ì•„í”„ë¦¬ì¹´ê³µí™”êµ­</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_NG" name="countries" value="nigeria">
                                    <label for="country_NG">ğŸ‡³ğŸ‡¬ ë‚˜ì´ì§€ë¦¬ì•„</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_EG" name="countries" value="egypt">
                                    <label for="country_EG">ğŸ‡ªğŸ‡¬ ì´ì§‘íŠ¸</label>
                                </div>
                                <!-- ê¸°íƒ€ -->
                                <div class="category-item" style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                    <span>ê¸°íƒ€</span>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_RU" name="countries" value="russia">
                                    <label for="country_RU">ğŸ‡·ğŸ‡º ëŸ¬ì‹œì•„</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="country_CN" name="countries" value="china">
                                    <label for="country_CN">ğŸ‡¨ğŸ‡³ ì¤‘êµ­</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="keyword">ê²€ìƒ‰ í‚¤ì›Œë“œ</label>
                    <input type="text" id="keyword" name="keyword" placeholder="í‚¤ì›Œë“œ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ì¸ê¸° ë™ì˜ìƒ ê²€ìƒ‰)">
                </div>

                <div class="form-group">
                    <label for="searchScope">ê²€ìƒ‰ ë²”ìœ„</label>
                    <div class="category-selector">
                        <div class="category-display" id="searchScopeDisplay">ì˜ìƒì œëª© ì„ íƒë¨</div>
                        <div class="category-dropdown" id="searchScopeDropdown">
                            <div class="category-header">
                                <input type="checkbox" id="selectAllSearchScope">
                                <label for="selectAllSearchScope">ëª¨ë“  ë²”ìœ„</label>
                            </div>
                            <div class="category-options">
                                <div class="category-item">
                                    <input type="checkbox" id="searchTitle" name="searchScope" value="title" checked>
                                    <label for="searchTitle">ì˜ìƒì œëª©</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="searchChannel" name="searchScope" value="channel">
                                    <label for="searchChannel">ì±„ë„ëª…</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="viewRange">ì¡°íšŒìˆ˜</label>
                    <div class="date-range-container">
                        <div class="date-input-group">
                            <input type="number" id="minViews" name="minViews" value="100000" placeholder="ìµœì†Œ ì¡°íšŒìˆ˜" />
                        </div>
                        <div class="date-input-group">
                            <input type="number" id="maxViews" name="maxViews" placeholder="ìµœëŒ€ ì¡°íšŒìˆ˜" />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="categories">ì¹´í…Œê³ ë¦¬</label>
                    <div class="category-selector">
                        <div class="category-display" id="categoryDisplay" tabindex="0">ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì„ íƒë¨</div>
                        <div class="category-dropdown" id="categoryDropdown">
                            <div class="category-header">
                                <input type="checkbox" id="selectAllCategories" checked>
                                <label for="selectAllCategories">ëª¨ë“  ì¹´í…Œê³ ë¦¬</label>
                            </div>
                            <div class="category-options">
                                <div class="category-item">
                                    <input type="checkbox" id="cat1" name="categories" value="1" checked>
                                    <label for="cat1">Film & Animation</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat2" name="categories" value="2" checked>
                                    <label for="cat2">Autos & Vehicles</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat10" name="categories" value="10" checked>
                                    <label for="cat10">Music</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat15" name="categories" value="15" checked>
                                    <label for="cat15">Pets & Animals</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat17" name="categories" value="17" checked>
                                    <label for="cat17">Sports</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat19" name="categories" value="19" checked>
                                    <label for="cat19">Travel & Events</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat20" name="categories" value="20" checked>
                                    <label for="cat20">Gaming</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat22" name="categories" value="22" checked>
                                    <label for="cat22">People & Blogs</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat23" name="categories" value="23" checked>
                                    <label for="cat23">Comedy</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat24" name="categories" value="24" checked>
                                    <label for="cat24">Entertainment</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat25" name="categories" value="25" checked>
                                    <label for="cat25">News & Politics</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat26" name="categories" value="26" checked>
                                    <label for="cat26">Howto & Style</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat27" name="categories" value="27" checked>
                                    <label for="cat27">Education</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat28" name="categories" value="28" checked>
                                    <label for="cat28">Science & Technology</label>
                                </div>
                                <div class="category-item">
                                    <input type="checkbox" id="cat29" name="categories" value="29" checked>
                                    <label for="cat29">Nonprofits & Activism</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="maxResults">ê²€ìƒ‰ ê²°ê³¼ ìˆ˜</label>
                    <select id="maxResults" name="maxResults">
                        <option value="10">10ê±´ (ìµœì†Œ)</option>
                        <option value="20" selected>20ê±´ (ê¸°ë³¸)</option>
                        <option value="30">30ê±´ (ì ìŒ)</option>
                        <option value="40">40ê±´ (ì†ŒëŸ‰)</option>
                        <option value="50">50ê±´ (ì ë‹¹)</option>
                        <option value="60">60ê±´ (quota ì ˆì•½)</option>
                        <option value="100">100ê±´ (ê· í˜•)</option>
                        <option value="150">150ê±´ (ë§ìŒ)</option>
                        <option value="200">200ê±´ (ìµœëŒ€)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="uploadPeriod">ì—…ë¡œë“œ ê¸°ê°„</label>
                    <select id="uploadPeriod" name="uploadPeriod">
                        <option value="">ì „ì²´ ê¸°ê°„</option>
                        <option value="1day">1ì¼</option>
                        <option value="1week">1ì£¼ì¼</option>
                        <option value="1month">1ê°œì›”</option>
                        <option value="3months">3ê°œì›”</option>
                        <option value="6months">6ê°œì›”</option>
                        <option value="1year">1ë…„</option>
                        <option value="2years">2ë…„</option>
                        <option value="3years">3ë…„</option>
                        <option value="4years">4ë…„</option>
                        <option value="5years">5ë…„</option>
                        <option value="6years">6ë…„</option>
                        <option value="7years">7ë…„</option>
                        <option value="8years">8ë…„</option>
                        <option value="9years">9ë…„</option>
                        <option value="10years">10ë…„</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="uploadDateRange">ì—…ë¡œë“œ ì—°ë„</label>
                    <div class="date-range-container">
                        <div class="date-input-group">
                            <input type="date" id="startDate" name="startDate" placeholder="ì‹œì‘ì¼" />
                        </div>
                        <div class="date-input-group">
                            <input type="date" id="endDate" name="endDate" placeholder="ì¢…ë£Œì¼" />
                        </div>
                    </div>
                </div>

            </div>

            <!-- ë™ì˜ìƒ ê¸¸ì´ ì„ íƒ (ë³„ë„ ì„¹ì…˜ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ë„“ì€ ê³µê°„ í™•ë³´) -->
            <div class="video-length-section">
                <div class="section-header">
                    <label class="section-label">ë™ì˜ìƒ ê¸¸ì´</label>
                    <div class="select-controls">
                        <div class="select-all-container">
                            <input type="checkbox" id="selectAllVideoLength">
                            <label for="selectAllVideoLength">ëª¨ë‘ ì„ íƒ</label>
                        </div>
                        <div class="select-group-container">
                            <input type="checkbox" id="selectFirst2VideoLength" checked>
                            <label for="selectFirst2VideoLength">ë§¨ ì• ë‘ ê°œë§Œ</label>
                        </div>
                        <div class="select-group-container">
                            <input type="checkbox" id="selectNext3VideoLength">
                            <label for="selectNext3VideoLength">ê·¸ ë’¤ ì„¸ ê°œë§Œ</label>
                        </div>
                        <div class="select-group-container">
                            <input type="checkbox" id="selectTop5VideoLength">
                            <label for="selectTop5VideoLength">ìœ„ 5ê°œ ì„ íƒ</label>
                        </div>
                        <div class="select-group-container">
                            <input type="checkbox" id="selectBottom5VideoLength">
                            <label for="selectBottom5VideoLength">ë°‘ 5ê°œ ì„ íƒ</label>
                        </div>
                    </div>
                </div>
                <div class="video-length-grid">
                    <div class="checkbox-item">
                        <input type="checkbox" id="shortForm1" name="videoLength" value="short1" checked>
                        <label for="shortForm1">Short Form1<br><span class="duration-desc">(1ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="shortForm2" name="videoLength" value="short2" checked>
                        <label for="shortForm2">Short Form2<br><span class="duration-desc">(1ë¶„ ì´ìƒ 2ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="midForm1" name="videoLength" value="mid1">
                        <label for="midForm1">Mid Form1<br><span class="duration-desc">(2ë¶„ ì´ìƒ 10ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="midForm2" name="videoLength" value="mid2">
                        <label for="midForm2">Mid Form2<br><span class="duration-desc">(10ë¶„ ì´ìƒ 20ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="longForm1" name="videoLength" value="long1">
                        <label for="longForm1">Long Form1<br><span class="duration-desc">(20ë¶„ ì´ìƒ 30ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="longForm2" name="videoLength" value="long2">
                        <label for="longForm2">Long Form2<br><span class="duration-desc">(30ë¶„ ì´ìƒ 40ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="longForm3" name="videoLength" value="long3">
                        <label for="longForm3">Long Form3<br><span class="duration-desc">(40ë¶„ ì´ìƒ 50ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="longForm4" name="videoLength" value="long4">
                        <label for="longForm4">Long Form4<br><span class="duration-desc">(50ë¶„ ì´ìƒ 60ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="longForm5" name="videoLength" value="long5">
                        <label for="longForm5">Long Form5<br><span class="duration-desc">(60ë¶„ ì´ìƒ 90ë¶„ ë¯¸ë§Œ)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="longForm6" name="videoLength" value="long6">
                        <label for="longForm6">Long Form6<br><span class="duration-desc">(90ë¶„ ì´ìƒ)</span></label>
                    </div>
                </div>
            </div>

            <!-- ì—…ë¡œë“œ ì‹œê°„ëŒ€ í•„í„° -->
            <div class="video-length-section">
                <div class="section-header">
                    <label class="section-label">ğŸ• ì—…ë¡œë“œ ì‹œê°„ëŒ€ í•„í„°</label>
                    <div class="select-controls">
                        <div class="select-all-container">
                            <input type="checkbox" id="selectAllTimezone">
                            <label for="selectAllTimezone">ëª¨ë‘ ì„ íƒ</label>
                        </div>
                        <div class="select-group-container">
                            <input type="checkbox" id="selectGoldenTime" checked>
                            <label for="selectGoldenTime">ê³¨ë“ íƒ€ì„</label>
                        </div>
                        <div class="select-group-container">
                            <input type="checkbox" id="selectPeakTime">
                            <label for="selectPeakTime">í”¼í¬íƒ€ì„</label>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 15px; color: #666; font-size: 0.9em;">
                    ì—…ë¡œë“œëœ ì‹œê°„ëŒ€ì— ë”°ë¼ ë–¡ìƒ í™•ë¥ ì´ ìµœëŒ€ 500% ì°¨ì´ë‚©ë‹ˆë‹¤! "í™©ê¸ˆì˜ ì²« 2ì‹œê°„" ë²•ì¹™ ì ìš©
                </div>
                <div class="video-length-grid">
                    <!-- ê¸€ë¡œë²Œ & ë²”ìš© ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneGlobalSweet" name="uploadTimezone" value="global_sweet" checked>
                        <label for="timezoneGlobalSweet">ğŸŒ ê¸€ë¡œë²Œ ìŠ¤ìœ—ìŠ¤íŒŸ<br><span class="duration-desc">(14:00-16:00 EST / ë–¡ìƒë¥  42%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneShortsPeak" name="uploadTimezone" value="shorts_peak" checked>
                        <label for="timezoneShortsPeak">ğŸ“± ì‡¼ì¸  í”¼í¬íƒ€ì„<br><span class="duration-desc">(07:00-09:00, 12:00-13:00, 18:00-20:00 / ë–¡ìƒë¥  45%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneWeekend" name="uploadTimezone" value="weekend" checked>
                        <label for="timezoneWeekend">ğŸ‰ ì£¼ë§ ì˜¤í›„ íƒ€ì„<br><span class="duration-desc">(í† ì¼ 14:00-18:00 / ë–¡ìƒë¥  25%)</span></label>
                    </div>
                    
                    <!-- ì•„ì‹œì•„-íƒœí‰ì–‘ ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneKrGolden" name="uploadTimezone" value="kr_golden" checked>
                        <label for="timezoneKrGolden">ğŸ‡°ğŸ‡· í•œêµ­ ê³¨ë“ íƒ€ì„<br><span class="duration-desc">(18:00-23:00 KST / ë–¡ìƒë¥  35%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneJpPrime" name="uploadTimezone" value="jp_prime">
                        <label for="timezoneJpPrime">ğŸ‡¯ğŸ‡µ ì¼ë³¸ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 JST / ë–¡ìƒë¥  24%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneInPrime" name="uploadTimezone" value="in_prime">
                        <label for="timezoneInPrime">ğŸ‡®ğŸ‡³ ì¸ë„ ì €ë…ì‹œê°„<br><span class="duration-desc">(18:00-22:00 IST / ë–¡ìƒë¥  25%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneThGolden" name="uploadTimezone" value="th_golden">
                        <label for="timezoneThGolden">ğŸ‡¹ğŸ‡­ íƒœêµ­ ê³¨ë“ íƒ€ì„<br><span class="duration-desc">(19:00-23:00 ICT / ë–¡ìƒë¥  23%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneVnEvening" name="uploadTimezone" value="vn_evening">
                        <label for="timezoneVnEvening">ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨ ì €ë…ì‹œê°„<br><span class="duration-desc">(18:00-22:00 ICT / ë–¡ìƒë¥  22%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneIdPrime" name="uploadTimezone" value="id_prime">
                        <label for="timezoneIdPrime">ğŸ‡®ğŸ‡© ì¸ë„ë„¤ì‹œì•„ í”„ë¼ì„<br><span class="duration-desc">(19:00-23:00 WIB / ë–¡ìƒë¥  21%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneAuPrime" name="uploadTimezone" value="au_prime">
                        <label for="timezoneAuPrime">ğŸ‡¦ğŸ‡º í˜¸ì£¼ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 AEST / ë–¡ìƒë¥  26%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneCnEvening" name="uploadTimezone" value="cn_evening">
                        <label for="timezoneCnEvening">ğŸ‡¨ğŸ‡³ ì¤‘êµ­ ì €ë…ì‹œê°„<br><span class="duration-desc">(19:00-23:00 CST / ë–¡ìƒë¥  28%)</span></label>
                    </div>
                    
                    <!-- ë¶ë¯¸ ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneUsEast" name="uploadTimezone" value="us_east_prime">
                        <label for="timezoneUsEast">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ë™ë¶€ í”„ë¼ì„<br><span class="duration-desc">(19:00-23:00 EST / ë–¡ìƒë¥  28%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneUsWest" name="uploadTimezone" value="us_west_prime">
                        <label for="timezoneUsWest">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì„œë¶€ í”„ë¼ì„<br><span class="duration-desc">(19:00-23:00 PST / ë–¡ìƒë¥  27%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneCaPrime" name="uploadTimezone" value="ca_prime">
                        <label for="timezoneCaPrime">ğŸ‡¨ğŸ‡¦ ìºë‚˜ë‹¤ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 EST / ë–¡ìƒë¥  26%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneMxPrime" name="uploadTimezone" value="mx_prime">
                        <label for="timezoneMxPrime">ğŸ‡²ğŸ‡½ ë©•ì‹œì½” í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(20:00-24:00 CST / ë–¡ìƒë¥  24%)</span></label>
                    </div>
                    
                    <!-- ìœ ëŸ½ ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneGbPrime" name="uploadTimezone" value="gb_prime">
                        <label for="timezoneGbPrime">ğŸ‡¬ğŸ‡§ ì˜êµ­ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 GMT / ë–¡ìƒë¥  26%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneDePrime" name="uploadTimezone" value="de_prime">
                        <label for="timezoneDePrime">ğŸ‡©ğŸ‡ª ë…ì¼ ê³¨ë“ ì•„ì›Œ<br><span class="duration-desc">(18:00-22:00 CET / ë–¡ìƒë¥  24%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneFrEvening" name="uploadTimezone" value="fr_evening">
                        <label for="timezoneFrEvening">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤ ì €ë…ì‹œê°„<br><span class="duration-desc">(19:00-22:00 CET / ë–¡ìƒë¥  23%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneEsPrime" name="uploadTimezone" value="es_prime">
                        <label for="timezoneEsPrime">ğŸ‡ªğŸ‡¸ ìŠ¤í˜ì¸ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(20:00-24:00 CET / ë–¡ìƒë¥  25%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneItPrime" name="uploadTimezone" value="it_prime">
                        <label for="timezoneItPrime">ğŸ‡®ğŸ‡¹ ì´íƒˆë¦¬ì•„ í”„ë¼ì„<br><span class="duration-desc">(20:00-23:00 CET / ë–¡ìƒë¥  23%)</span></label>
                    </div>
                    
                    <!-- ë‚¨ë¯¸ ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneBrPrime" name="uploadTimezone" value="br_prime">
                        <label for="timezoneBrPrime">ğŸ‡§ğŸ‡· ë¸Œë¼ì§ˆ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(20:00-23:00 BRT / ë–¡ìƒë¥  27%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneArPrime" name="uploadTimezone" value="ar_prime">
                        <label for="timezoneArPrime">ğŸ‡¦ğŸ‡· ì•„ë¥´í—¨í‹°ë‚˜ í”¼í¬<br><span class="duration-desc">(19:00-22:00 ART / ë–¡ìƒë¥  21%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneCoPrime" name="uploadTimezone" value="co_prime">
                        <label for="timezoneCoPrime">ğŸ‡¨ğŸ‡´ ì½œë¡¬ë¹„ì•„ í”„ë¼ì„<br><span class="duration-desc">(19:00-23:00 COT / ë–¡ìƒë¥  22%)</span></label>
                    </div>
                    
                    <!-- ì¤‘ë™ & ì•„í”„ë¦¬ì¹´ ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneSaPrime" name="uploadTimezone" value="sa_prime">
                        <label for="timezoneSaPrime">ğŸ‡¸ğŸ‡¦ ì‚¬ìš°ë”” í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(20:00-24:00 AST / ë–¡ìƒë¥  26%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneAePrime" name="uploadTimezone" value="ae_prime">
                        <label for="timezoneAePrime">ğŸ‡¦ğŸ‡ª UAE ê³¨ë“ íƒ€ì„<br><span class="duration-desc">(19:00-23:00 GST / ë–¡ìƒë¥  25%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneZaPrime" name="uploadTimezone" value="za_prime">
                        <label for="timezoneZaPrime">ğŸ‡¿ğŸ‡¦ ë‚¨ì•„ê³µ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 SAST / ë–¡ìƒë¥  24%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneNgPrime" name="uploadTimezone" value="ng_prime">
                        <label for="timezoneNgPrime">ğŸ‡³ğŸ‡¬ ë‚˜ì´ì§€ë¦¬ì•„ ê³¨ë“ <br><span class="duration-desc">(19:00-23:00 WAT / ë–¡ìƒë¥  23%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneEgPrime" name="uploadTimezone" value="eg_prime">
                        <label for="timezoneEgPrime">ğŸ‡ªğŸ‡¬ ì´ì§‘íŠ¸ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 EET / ë–¡ìƒë¥  22%)</span></label>
                    </div>
                    
                    <!-- ê¸°íƒ€ ì‹œê°„ëŒ€ -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneRuPrime" name="uploadTimezone" value="ru_prime">
                        <label for="timezoneRuPrime">ğŸ‡·ğŸ‡º ëŸ¬ì‹œì•„ í”„ë¼ì„íƒ€ì„<br><span class="duration-desc">(19:00-23:00 MSK / ë–¡ìƒë¥  25%)</span></label>
                    </div>
                    
                    <!-- í•œêµ­ ì„¸ë¶€ ì‹œê°„ëŒ€ (ê¸°ì¡´) -->
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneKrLunch" name="uploadTimezone" value="kr_lunch">
                        <label for="timezoneKrLunch">ğŸ± í•œêµ­ ì ì‹¬ í”¼í¬<br><span class="duration-desc">(11:00-14:00 KST / ë–¡ìƒë¥  22%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneKrNight" name="uploadTimezone" value="kr_night">
                        <label for="timezoneKrNight">ğŸŒ™ í•œêµ­ ì‹¬ì•¼íƒ€ì„<br><span class="duration-desc">(23:00-02:00 KST / ë–¡ìƒë¥  18%)</span></label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timezoneKrMorning" name="uploadTimezone" value="kr_morning">
                        <label for="timezoneKrMorning">ğŸš‡ í•œêµ­ ì¶œê·¼ì‹œê°„<br><span class="duration-desc">(07:00-09:00 KST / ë–¡ìƒë¥  15%)</span></label>
                    </div>
                </div>
            </div>

            <button type="submit" class="search-btn">
                ğŸ” ë–¡ìƒ ê²€ìƒ‰í•˜ê¸°
            </button>
        </form>

        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>

        <div id="resultsContainer" class="results-container" style="display: none;">
            <div class="results-header">
                <div class="results-info">
                    <span id="resultsCount">0</span>ê°œì˜ ê²°ê³¼ê°€ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.
                </div>
                <div class="results-controls">
                    <div class="pagination-controls">
                        <label>(êµ¬ë…ììˆ˜: ë§Œ ë‹¨ìœ„) &nbsp;&nbsp;í˜ì´ì§€ë‹¹ í‘œì‹œ:</label>
                        <select id="itemsPerPage">
                            <option value="10">10ê°œ</option>
                            <option value="20">20ê°œ</option>
                            <option value="30" selected>30ê°œ</option>
                            <option value="40">40ê°œ</option>
                            <option value="50">50ê°œ</option>
                            <option value="100">100ê°œ</option>
                            <option value="150">150ê°œ</option>
                            <option value="200">200ê°œ</option>
                        </select>
                    </div>
                    <button id="downloadExcelBtn" class="excel-download-btn" style="display: none;" title="í´ë¦­í•˜ë©´ ì €ì¥ ìœ„ì¹˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (Chrome/Edge 86+ ì§€ì›)">
                        ğŸ“Š
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th data-sort="thumbnail_url">ğŸ‘</th>
                            <th data-sort="youtube_channel_name" class="sortable">ì±„ë„ëª…</th>
                            <th data-sort="title" class="sortable">ì˜ìƒì œëª©</th>
                            <th data-sort="primary_category" class="sortable">ì¹´í…Œê³ ë¦¬</th>
                            <th data-sort="status_date" class="sortable">í˜„ì§€ì‹œê°„</th>
                            <th data-sort="status_date" class="sortable">í•œêµ­ì‹œê°„</th>
                            <th data-sort="daily_view_count" class="sortable">ğŸ‘“</th>
                            <th data-sort="subscriber_count" class="sortable">ğŸ‘ª</th>
                            <th data-sort="vod_url">â–¶ï¸</th>
                            <th data-sort="duration" class="sortable">â°</th>
                            <th>ğŸ‘</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination">
            </div>
        </div>
    </div>

    <script>
        let searchResults = [];
        let currentPage = 1;
        let itemsPerPage = 30;
        let sortColumn = 'daily_view_count';
        let sortDirection = 'desc';

        // ê²€ìƒ‰ í¼ ì œì¶œ ì´ë²¤íŠ¸
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await performSearch();
        });
        
        console.log('âœ… ë¬¸ì„œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');



        // ê²€ìƒ‰ ë²”ìœ„ ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥
        document.getElementById('searchScopeDisplay').addEventListener('click', () => {
            const dropdown = document.getElementById('searchScopeDropdown');
            dropdown.classList.toggle('show');
        });

        // ëª¨ë“  ê²€ìƒ‰ ë²”ìœ„ ì„ íƒ/í•´ì œ
        document.getElementById('selectAllSearchScope').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]');
            
            searchScopeCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateSearchScopeDisplay();
        });

        // ê°œë³„ ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.querySelectorAll('input[name="searchScope"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                updateSelectAllSearchScope();
                updateSearchScopeDisplay();
            });
        });

        // ê²€ìƒ‰ ë²”ìœ„ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSearchScopeDisplay() {
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]:checked');
            const display = document.getElementById('searchScopeDisplay');
            
            if (searchScopeCheckboxes.length === 0) {
                display.textContent = 'ê²€ìƒ‰ ë²”ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            } else if (searchScopeCheckboxes.length === document.querySelectorAll('input[name="searchScope"]').length) {
                display.textContent = 'ëª¨ë“  ë²”ìœ„ ì„ íƒë¨';
            } else {
                const selectedNames = Array.from(searchScopeCheckboxes).map(cb => {
                    const label = cb.parentElement.querySelector('label');
                    return label.textContent;
                });
                display.textContent = selectedNames.join(', ') + ' ì„ íƒë¨';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì •
        updateSearchScopeDisplay();

        // ëª¨ë“  ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllSearchScope() {
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]');
            const checkedSearchScope = document.querySelectorAll('input[name="searchScope"]:checked');
            const selectAllCheckbox = document.getElementById('selectAllSearchScope');
            
            if (checkedSearchScope.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedSearchScope.length === searchScopeCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥ì€ DOMContentLoaded ì´ë²¤íŠ¸ì—ì„œ ì„¤ì •ë¨

        // ë¬¸ì„œ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            // ê²€ìƒ‰ ë²”ìœ„ ë“œë¡­ë‹¤ìš´ ì²˜ë¦¬
            const searchScopeDisplay = document.getElementById('searchScopeDisplay');
            const searchScopeDropdown = document.getElementById('searchScopeDropdown');
            
            if (searchScopeDisplay && searchScopeDropdown) {
                const searchScopeSelector = searchScopeDisplay.closest('.category-selector');
                if (searchScopeSelector && !searchScopeSelector.contains(e.target)) {
                    searchScopeDropdown.classList.remove('show');
                }
            }
            
            // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì²˜ë¦¬
            const categoryDisplay = document.getElementById('categoryDisplay');
            const categoryDropdown = document.getElementById('categoryDropdown');
            
            if (categoryDisplay && categoryDropdown) {
                const categorySelector = categoryDisplay.closest('.category-selector');
                if (categorySelector && !categorySelector.contains(e.target)) {
                    categoryDropdown.classList.remove('show');
                }
            }
            
            // êµ­ê°€ ë“œë¡­ë‹¤ìš´ ì²˜ë¦¬ (ìˆ˜ì •ë¨)
            const countryDisplay = document.getElementById('countryDisplay');
            const countryDropdown = document.getElementById('countryDropdown');
            
            if (countryDisplay && countryDropdown) {
                const countrySelector = countryDisplay.closest('.category-selector');
                if (countrySelector && !countrySelector.contains(e.target)) {
                    countryDropdown.classList.remove('show');
                    console.log('ğŸ’µ êµ­ê°€ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°');
                }
            }
        });

        // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì„ íƒ/í•´ì œ
        document.getElementById('selectAllCategories').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const categoryCheckboxes = document.querySelectorAll('input[name="categories"]');
            
            categoryCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateCategoryDisplay();
        });

        // ê°œë³„ ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.querySelectorAll('input[name="categories"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                updateSelectAllCategories();
                updateCategoryDisplay();
            });
        });

        // ì¹´í…Œê³ ë¦¬ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCategoryDisplay() {
            const categoryCheckboxes = document.querySelectorAll('input[name="categories"]:checked');
            const display = document.getElementById('categoryDisplay');
            
            if (categoryCheckboxes.length === 0) {
                display.textContent = 'ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            } else if (categoryCheckboxes.length === document.querySelectorAll('input[name="categories"]').length) {
                display.textContent = 'ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì„ íƒë¨';
            } else if (categoryCheckboxes.length <= 3) {
                const selectedNames = Array.from(categoryCheckboxes).map(cb => {
                    const label = cb.parentElement.querySelector('label');
                    return label.textContent;
                });
                display.textContent = selectedNames.join(', ');
            } else {
                display.textContent = `${categoryCheckboxes.length}ê°œ ì¹´í…Œê³ ë¦¬ ì„ íƒë¨`;
            }
        }

        // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllCategories() {
            const categoryCheckboxes = document.querySelectorAll('input[name="categories"]');
            const checkedCategories = document.querySelectorAll('input[name="categories"]:checked');
            const selectAllCheckbox = document.getElementById('selectAllCategories');
            
            if (checkedCategories.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCategories.length === categoryCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ (íŒŒì¼ëª… ì•ˆì „í™” ì²˜ë¦¬)
        async function downloadThumbnail(url, channelName) {
            try {
                console.log('ğŸ“¥ ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘:', { url, channelName });
                
                // ì±„ë„ëª…ì„ ì•ˆì „í•œ íŒŒì¼ëª…ìœ¼ë¡œ ë³€í™˜ (ì„œë²„ ì¸¡ê³¼ ë™ì¼í•œ ë¡œì§)
                let safeChannelName = channelName || 'channel';
                
                // íŠ¹ìˆ˜ë¬¸ì ë° ìœ ë‹ˆì½”ë“œ ë¬¸ì ì²˜ë¦¬
                safeChannelName = safeChannelName
                    .normalize('NFD')                          // ìœ ë‹ˆì½”ë“œ ì •ê·œí™”
                    .replace(/[\u0300-\u036f]/g, '')          // ë°œìŒ ê¸°í˜¸ ì œê±°
                    .replace(/[^\x00-\x7F]/g, '')             // ASCIIê°€ ì•„ë‹Œ ë¬¸ì ì œê±° (í•œê¸€, ì´ëª¨ì§€ ë“±)
                    .replace(/[<>:"/\\|?*\x00-\x1f]/g, '_')   // íŒŒì¼ëª…ì— ì‚¬ìš© ë¶ˆê°€í•œ ë¬¸ìë“¤ ì œê±°
                    .replace(/["'`]/g, '')                    // ë”°ì˜´í‘œ ì œê±°
                    .replace(/\s+/g, '_')                     // ê³µë°±ì„ ì–¸ë”ìŠ¤ì½”ì–´ë¡œ ë³€ê²½
                    .replace(/_{2,}/g, '_')                   // ì—°ì†ëœ ì–¸ë”ìŠ¤ì½”ì–´ë¥¼ í•˜ë‚˜ë¡œ ë³€ê²½
                    .replace(/^_+|_+$/g, '')                  // ì•ë’¤ ì–¸ë”ìŠ¤ì½”ì–´ ì œê±°
                    .substring(0, 50);                       // íŒŒì¼ëª… ê¸¸ì´ ì œí•œ (í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ë” ì§§ê²Œ)
                
                // íŒŒì¼ëª…ì´ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
                if (!safeChannelName || safeChannelName.length === 0) {
                    safeChannelName = 'channel';
                }
                
                // í˜„ì¬ ë‚ ì§œì‹œê°„ì„ íŒŒì¼ëª…ì— ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
                const now = new Date();
                const year = now.getFullYear().toString().slice(-2); // ë’¤ 2ìë¦¬ë§Œ (25)
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hour = now.getHours().toString().padStart(2, '0');
                const minute = now.getMinutes().toString().padStart(2, '0');
                const second = now.getSeconds().toString().padStart(2, '0');
                const millisecond = now.getMilliseconds().toString().padStart(3, '0');
                
                const timestamp = `${year}${month}${day}${hour}${minute}${second}${millisecond}`;
                const filename = `${safeChannelName}_${timestamp}.jpg`;
                
                console.log('ğŸ”§ íŒŒì¼ëª… ë³€í™˜:', { 
                    original: channelName, 
                    safe: safeChannelName, 
                    final: filename 
                });
                
                // ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œ File System Access API ì§€ì› í™•ì¸
                if ('showSaveFilePicker' in window) {
                    // File System Access API ì‚¬ìš© (Chrome 86+, Edge 86+)
                    await downloadWithFilePicker(url, filename);
                } else if ('showDirectoryPicker' in window) {
                    // Directory Picker API ì‚¬ìš© (ëŒ€ì²´ ë°©ë²•)
                    await downloadWithDirectoryPicker(url, filename, channelName);
                } else {
                    // ê¸°ì¡´ ë°©ì‹ (ìë™ ë‹¤ìš´ë¡œë“œ) - ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•œ fallback
                    await downloadWithTraditionalMethod(url, filename);
                }
                
            } catch (error) {
                console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                
                // êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ì œê³µ
                if (error.message.includes('Content-Disposition') || 
                    error.message.includes('ERR_INVALID_CHAR') ||
                    error.message.includes('Invalid character in header')) {
                    alert(`âŒ íŒŒì¼ëª… ì˜¤ë¥˜: ì±„ë„ëª…ì— íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ë˜ì–´ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì›ì¸: "${channelName}"ì— HTTP í—¤ë”ì—ì„œ í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\ní•´ê²°: íŒŒì¼ëª…ì´ ìë™ìœ¼ë¡œ ì•ˆì „í•œ í˜•íƒœë¡œ ë³€í™˜ë˜ì—ˆì§€ë§Œ ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n\në‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.`);
                } else if (error.name === 'AbortError') {
                    console.log('ì‚¬ìš©ìê°€ ë‹¤ìš´ë¡œë“œë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert(`âŒ ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ${error.message}\n\nê°€ëŠ¥í•œ ì›ì¸:\n- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ\n- ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì„œë²„ ì ‘ê·¼ ë¶ˆê°€\n- íŒŒì¼ëª… ì²˜ë¦¬ ì˜¤ë¥˜\n\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.`);
                }
            }
        }

        // File System Access APIë¥¼ ì‚¬ìš©í•œ íŒŒì¼ ì €ì¥ (ê°œì„ ëœ ë²„ì „)
        async function downloadWithFilePicker(url, filename) {
            try {
                // íŒŒì¼ ì €ì¥ ìœ„ì¹˜ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
                const fileHandle = await window.showSaveFilePicker({
                    suggestedName: filename,
                    types: [{
                        description: 'ì´ë¯¸ì§€ íŒŒì¼',
                        accept: {
                            'image/jpeg': ['.jpg', '.jpeg'],
                            'image/png': ['.png'],
                            'image/webp': ['.webp']
                        }
                    }]
                });

                // URL ì¸ì½”ë”©ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
                const encodedUrl = encodeURIComponent(url);
                const encodedFilename = encodeURIComponent(filename);
                
                console.log('ğŸ”„ ì„œë²„ ìš”ì²­:', {
                    url: `/api/download-thumbnail?url=${encodedUrl}&filename=${encodedFilename}`,
                    originalUrl: url,
                    originalFilename: filename
                });
                
                const response = await fetch(`/api/download-thumbnail?url=${encodedUrl}&filename=${encodedFilename}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch {
                        errorData = { error: errorText };
                    }
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${errorData.error || 'Unknown error'}`);
                }
                
                const blob = await response.blob();
                
                // ì„ íƒí•œ ìœ„ì¹˜ì— íŒŒì¼ ì €ì¥
                const writable = await fileHandle.createWritable();
                await writable.write(blob);
                await writable.close();
                
                console.log(`âœ… ì¸ë„¤ì¼ ì €ì¥ ì™„ë£Œ: ${filename}`);
                alert(`âœ… ì¸ë„¤ì¼ì´ ì„ íƒí•œ ìœ„ì¹˜ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${filename}\ní¬ê¸°: ${(blob.size / 1024).toFixed(1)} KB`);
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('ì‚¬ìš©ìê°€ ì €ì¥ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                } else {
                    console.error('File System Access API ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                    throw error;
                }
            }
        }

        // Directory Picker APIë¥¼ ì‚¬ìš©í•œ í´ë” ì„ íƒ ì €ì¥
        async function downloadWithDirectoryPicker(url, filename, channelName) {
            try {
                // í´ë” ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
                const dirHandle = await window.showDirectoryPicker();
                
                // ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
                const response = await fetch(`/api/download-thumbnail?url=${encodeURIComponent(url)}&filename=${encodeURIComponent(filename)}`);
                
                // ì„œë²„ì—ì„œ ì „ì†¡í•œ ë¡œê·¸ë¥¼ ì½˜ì†”ì— ì¶œë ¥
                const downloadLog = response.headers.get('X-Download-Log');
                if (downloadLog) {
                    try {
                        const logData = JSON.parse(downloadLog);
                        console.log(`ğŸ“¥ ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ ë¡œê·¸: ${logData.message}`);
                        
                        // ì˜¤ë¥˜ê°€ ìˆëŠ” ê²½ìš° ìƒì„¸ ì •ë³´ ì¶œë ¥
                        if (logData.step === 'error') {
                            console.error(`âŒ ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ${logData.error}`);
                            console.error(`ğŸ“‹ ìƒì„¸ ì •ë³´: ${logData.details}`);
                            console.error(`ğŸ”— URL: ${logData.url}`);
                        }
                    } catch (parseError) {
                        console.log('ğŸ“¥ ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ ë¡œê·¸ íŒŒì‹± ì‹¤íŒ¨:', parseError);
                    }
                }
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorData.error || 'Unknown error'}`);
                }
                
                const blob = await response.blob();
                
                // ì„ íƒí•œ í´ë”ì— íŒŒì¼ ìƒì„± ë° ì €ì¥
                const fileHandle = await dirHandle.getFileHandle(filename, { create: true });
                const writable = await fileHandle.createWritable();
                await writable.write(blob);
                await writable.close();
                
                alert(`âœ… ì¸ë„¤ì¼ì´ ì„ íƒí•œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\níŒŒì¼ëª…: ${filename}`);
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('ì‚¬ìš©ìê°€ í´ë” ì„ íƒì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                } else {
                    throw error;
                }
            }
        }

        // ê¸°ì¡´ ë°©ì‹ ë‹¤ìš´ë¡œë“œ (ê°œì„ ëœ ë²„ì „)
        async function downloadWithTraditionalMethod(url, filename) {
            try {
                // URL ì¸ì½”ë”©ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
                const encodedUrl = encodeURIComponent(url);
                const encodedFilename = encodeURIComponent(filename);
                
                console.log('ğŸ”„ ê¸°ì¡´ ë°©ì‹ ë‹¤ìš´ë¡œë“œ:', { filename, encodedFilename });
                
                // ë¨¼ì € ì„œë²„ì—ì„œ íŒŒì¼ì„ ê°€ì ¸ì™€ì„œ ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€ í™•ì¸
                const testResponse = await fetch(`/api/download-thumbnail?url=${encodedUrl}&filename=${encodedFilename}`);
                
                if (!testResponse.ok) {
                    const errorText = await testResponse.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch {
                        errorData = { error: errorText };
                    }
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${testResponse.status}): ${errorData.error || 'Unknown error'}`);
                }
                
                // ì„±ê³µí•œ ê²½ìš° ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
                const downloadUrl = `/api/download-thumbnail?url=${encodedUrl}&filename=${encodedFilename}`;
                
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                console.log(`âœ… ê¸°ì¡´ ë°©ì‹ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${filename}`);
                alert(`ğŸ“ ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.\n\níŒŒì¼ëª…: ${filename}\nìœ„ì¹˜: ë¸Œë¼ìš°ì € ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë”\n(ë¸Œë¼ìš°ì €ê°€ í´ë” ì„ íƒ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)`);
                
            } catch (error) {
                console.error('ê¸°ì¡´ ë°©ì‹ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // í˜ì´ì§€ë‹¹ ì•„ì´í…œ ìˆ˜ ë³€ê²½ ì´ë²¤íŠ¸
        document.getElementById('itemsPerPage').addEventListener('change', (e) => {
            itemsPerPage = parseInt(e.target.value);
            currentPage = 1;
            renderResults();
        });

        // Excel ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('downloadExcelBtn').addEventListener('click', async () => {
            await downloadExcel();
        });

        // ë™ì˜ìƒ ê¸¸ì´ "ëª¨ë‘ ì„ íƒ" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('selectAllVideoLength').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const videoLengthCheckboxes = [
                'shortForm1', 'shortForm2', 'midForm1', 'midForm2', 
                'longForm1', 'longForm2', 'longForm3', 'longForm4', 'longForm5', 'longForm6'
            ];
            
            videoLengthCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = isChecked;
                }
            });
            
            // ê·¸ë£¹ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœë„ ì—…ë°ì´íŠ¸
            updateGroupCheckboxes();
        });

        // ë™ì˜ìƒ ê¸¸ì´ "ë§¨ ì• ë‘ ê°œë§Œ" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('selectFirst2VideoLength').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const first2Checkboxes = ['shortForm1', 'shortForm2'];
            
            first2Checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = isChecked;
                }
            });
            
            updateSelectAllVideoLength();
            updateGroupCheckboxes();
        });

        // ë™ì˜ìƒ ê¸¸ì´ "ê·¸ ë’¤ ì„¸ ê°œë§Œ" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('selectNext3VideoLength').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const next3Checkboxes = ['midForm1', 'midForm2', 'longForm1'];
            
            next3Checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = isChecked;
                }
            });
            
            updateSelectAllVideoLength();
            updateGroupCheckboxes();
        });

        // ë™ì˜ìƒ ê¸¸ì´ "ìœ„ 5ê°œ ì„ íƒ" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('selectTop5VideoLength').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const top5Checkboxes = ['shortForm1', 'shortForm2', 'midForm1', 'midForm2', 'longForm1'];
            
            top5Checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = isChecked;
                }
            });
            
            updateSelectAllVideoLength();
            updateGroupCheckboxes();
        });

        // ë™ì˜ìƒ ê¸¸ì´ "ë°‘ 5ê°œ ì„ íƒ" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('selectBottom5VideoLength').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const bottom5Checkboxes = ['longForm2', 'longForm3', 'longForm4', 'longForm5', 'longForm6'];
            
            bottom5Checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = isChecked;
                }
            });
            
            updateSelectAllVideoLength();
            updateGroupCheckboxes();
        });

        // ê°œë³„ ë™ì˜ìƒ ê¸¸ì´ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ "ëª¨ë‘ ì„ íƒ" ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllVideoLength() {
            const videoLengthCheckboxes = [
                'shortForm1', 'shortForm2', 'midForm1', 'midForm2', 
                'longForm1', 'longForm2', 'longForm3', 'longForm4', 'longForm5', 'longForm6'
            ];
            
            const checkedCount = videoLengthCheckboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectAllCheckbox = document.getElementById('selectAllVideoLength');
            if (checkedCount === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCount === videoLengthCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // í†µí•©ëœ ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeApp() {
            
            // ë™ì˜ìƒ ê¸¸ì´ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const videoLengthCheckboxes = [
                'shortForm1', 'shortForm2', 'midForm1', 'midForm2', 
                'longForm1', 'longForm2', 'longForm3', 'longForm4', 'longForm5', 'longForm6'
            ];
            
            videoLengthCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.addEventListener('change', () => {
                        updateSelectAllVideoLength();
                        updateGroupCheckboxes();
                    });
                }
            });
            
            // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
            const categoryDisplay = document.getElementById('categoryDisplay');
            const categoryDropdown = document.getElementById('categoryDropdown');
            
            if (categoryDisplay && categoryDropdown) {
                categoryDisplay.addEventListener('click', categoryDisplayClickHandler);
                categoryDisplay.addEventListener('keydown', categoryDisplayKeyHandler);
            }
            
            // êµ­ê°€ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” (ìƒˆë¡œ ì¶”ê°€)
            const countryDisplay = document.getElementById('countryDisplay');
            const countryDropdown = document.getElementById('countryDropdown');
            
            if (countryDisplay && countryDropdown) {
                countryDisplay.addEventListener('click', countryDisplayClickHandler);
                countryDisplay.addEventListener('keydown', countryDisplayKeyHandler);
                console.log('âœ… êµ­ê°€ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡ ì™„ë£Œ');
            } else {
                console.error('âŒ êµ­ê°€ ë“œë¡­ë‹¤ìš´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', { countryDisplay, countryDropdown });
            }
            
            // êµ­ê°€ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì´ˆê¸°í™” (ìƒˆë¡œ ì¶”ê°€)
            initializeCountryCheckboxes();
            
            // ì‹œê°„ëŒ€ í•„í„° ì´ˆê¸°í™”
            initializeTimezoneFilters();
            
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            updateSelectAllVideoLength();
            updateGroupCheckboxes();
            updateSearchScopeDisplay();
            updateCategoryDisplay();
            updateCountryDisplay(); // ìƒˆë¡œ ì¶”ê°€
            
        }
        
        // DOMContentLoaded ì´ë²¤íŠ¸ (ë‹¨ì¼)
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ í´ë¦­ í•¸ë“¤ëŸ¬ í•¨ìˆ˜
        function categoryDisplayClickHandler() {
            const dropdown = document.getElementById('categoryDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
                console.log('ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ í´ë¦­ë¨, show í´ë˜ìŠ¤:', dropdown.classList.contains('show'));
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function categoryDisplayKeyHandler(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                categoryDisplayClickHandler();
            }
        }

        // ê·¸ë£¹ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateGroupCheckboxes() {
            const first2Checkboxes = ['shortForm1', 'shortForm2'];
            const next3Checkboxes = ['midForm1', 'midForm2', 'longForm1'];
            const top5Checkboxes = ['shortForm1', 'shortForm2', 'midForm1', 'midForm2', 'longForm1'];
            const bottom5Checkboxes = ['longForm2', 'longForm3', 'longForm4', 'longForm5', 'longForm6'];
            
            // ë§¨ ì• ë‘ ê°œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const first2CheckedCount = first2Checkboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectFirst2Checkbox = document.getElementById('selectFirst2VideoLength');
            if (first2CheckedCount === 0) {
                selectFirst2Checkbox.checked = false;
                selectFirst2Checkbox.indeterminate = false;
            } else if (first2CheckedCount === first2Checkboxes.length) {
                selectFirst2Checkbox.checked = true;
                selectFirst2Checkbox.indeterminate = false;
            } else {
                selectFirst2Checkbox.checked = false;
                selectFirst2Checkbox.indeterminate = true;
            }
            
            // ê·¸ ë’¤ ì„¸ ê°œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const next3CheckedCount = next3Checkboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectNext3Checkbox = document.getElementById('selectNext3VideoLength');
            if (next3CheckedCount === 0) {
                selectNext3Checkbox.checked = false;
                selectNext3Checkbox.indeterminate = false;
            } else if (next3CheckedCount === next3Checkboxes.length) {
                selectNext3Checkbox.checked = true;
                selectNext3Checkbox.indeterminate = false;
            } else {
                selectNext3Checkbox.checked = false;
                selectNext3Checkbox.indeterminate = true;
            }
            
            // ìœ„ 5ê°œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const top5CheckedCount = top5Checkboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectTop5Checkbox = document.getElementById('selectTop5VideoLength');
            if (top5CheckedCount === 0) {
                selectTop5Checkbox.checked = false;
                selectTop5Checkbox.indeterminate = false;
            } else if (top5CheckedCount === top5Checkboxes.length) {
                selectTop5Checkbox.checked = true;
                selectTop5Checkbox.indeterminate = false;
            } else {
                selectTop5Checkbox.checked = false;
                selectTop5Checkbox.indeterminate = true;
            }
            
            // ë°‘ 5ê°œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const bottom5CheckedCount = bottom5Checkboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectBottom5Checkbox = document.getElementById('selectBottom5VideoLength');
            if (bottom5CheckedCount === 0) {
                selectBottom5Checkbox.checked = false;
                selectBottom5Checkbox.indeterminate = false;
            } else if (bottom5CheckedCount === bottom5Checkboxes.length) {
                selectBottom5Checkbox.checked = true;
                selectBottom5Checkbox.indeterminate = false;
            } else {
                selectBottom5Checkbox.checked = false;
                selectBottom5Checkbox.indeterminate = true;
            }
        }



        // ê²€ìƒ‰ ìˆ˜í–‰ í•¨ìˆ˜
        async function performSearch() {
            const formData = new FormData(document.getElementById('searchForm'));
            const searchParams = new URLSearchParams();

            // í¼ ë°ì´í„° ì²˜ë¦¬
            for (let [key, value] of formData.entries()) {
                if (key === 'videoLength') {
                    // ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬ëŠ” ë³„ë„ë¡œ
                    continue;
                }
                if (value) {
                    searchParams.append(key, value);
                }
            }

            // ë‚ ì§œ ë²”ìœ„ ì²˜ë¦¬
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // ë‚ ì§œ ìœ íš¨ì„± ê²€ì¦
            let validStartDate = null;
            let validEndDate = null;
            
            if (startDate) {
                try {
                    const testDate = new Date(startDate);
                    if (!isNaN(testDate.getTime()) && startDate.match(/^\d{4}-\d{2}-\d{2}$/)) {
                        validStartDate = startDate;
                        searchParams.append('startDate', startDate);
                        console.log('âœ… í´ë¼ì´ì–¸íŠ¸: ì‹œì‘ì¼ ìœ íš¨ì„± ê²€ì¦ í†µê³¼:', startDate);
                    } else {
                        console.warn('âš ï¸ í´ë¼ì´ì–¸íŠ¸: ì‹œì‘ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ:', startDate);
                    }
                } catch (error) {
                    console.error('âŒ í´ë¼ì´ì–¸íŠ¸: ì‹œì‘ì¼ ê²€ì¦ ì˜¤ë¥˜:', error.message);
                }
            }
            
            if (endDate) {
                try {
                    const testDate = new Date(endDate);
                    if (!isNaN(testDate.getTime()) && endDate.match(/^\d{4}-\d{2}-\d{2}$/)) {
                        validEndDate = endDate;
                        searchParams.append('endDate', endDate);
                        console.log('âœ… í´ë¼ì´ì–¸íŠ¸: ì¢…ë£Œì¼ ìœ íš¨ì„± ê²€ì¦ í†µê³¼:', endDate);
                    } else {
                        console.warn('âš ï¸ í´ë¼ì´ì–¸íŠ¸: ì¢…ë£Œì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŒ:', endDate);
                    }
                } catch (error) {
                    console.error('âŒ í´ë¼ì´ì–¸íŠ¸: ì¢…ë£Œì¼ ê²€ì¦ ì˜¤ë¥˜:', error.message);
                }
            }
            
            // ë‚ ì§œ ìˆœì„œ ê²€ì¦
            if (validStartDate && validEndDate) {
                const start = new Date(validStartDate);
                const end = new Date(validEndDate);
                if (start > end) {
                    console.warn('âš ï¸ ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }
            
            console.log('ğŸ“… ë‚ ì§œ ë²”ìœ„ ë””ë²„ê·¸:', {
                ì›ë³¸_startDate: startDate || 'ì—†ìŒ',
                ì›ë³¸_endDate: endDate || 'ì—†ìŒ',
                ìœ íš¨í•œ_startDate: validStartDate || 'ì—†ìŒ',
                ìœ íš¨í•œ_endDate: validEndDate || 'ì—†ìŒ',
                hasDateRange: !!(validStartDate || validEndDate)
            });

            // ë¹„ë””ì˜¤ ê¸¸ì´ ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬
            const shortForm1 = document.getElementById('shortForm1').checked;
            const shortForm2 = document.getElementById('shortForm2').checked;
            const midForm1 = document.getElementById('midForm1').checked;
            const midForm2 = document.getElementById('midForm2').checked;
            const longForm1 = document.getElementById('longForm1').checked;
            const longForm2 = document.getElementById('longForm2').checked;
            const longForm3 = document.getElementById('longForm3').checked;
            const longForm4 = document.getElementById('longForm4').checked;
            const longForm5 = document.getElementById('longForm5').checked;
            const longForm6 = document.getElementById('longForm6').checked;
            
            const selectedLengths = [];
            if (shortForm1) selectedLengths.push('short1');
            if (shortForm2) selectedLengths.push('short2');
            if (midForm1) selectedLengths.push('mid1');
            if (midForm2) selectedLengths.push('mid2');
            if (longForm1) selectedLengths.push('long1');
            if (longForm2) selectedLengths.push('long2');
            if (longForm3) selectedLengths.push('long3');
            if (longForm4) selectedLengths.push('long4');
            if (longForm5) selectedLengths.push('long5');
            if (longForm6) selectedLengths.push('long6');
            
            // ë™ì˜ìƒ ê¸¸ì´ íŒŒë¼ë¯¸í„° (ë¹ˆ ë°°ì—´ì´ì–´ë„ ì „ì†¡)
            console.log('ğŸ¬ ë™ì˜ìƒ ê¸¸ì´ ë””ë²„ê·¸:', {
                selectedLengths: selectedLengths,
                lengthCount: selectedLengths.length,
                joinedString: selectedLengths.join(','),
                willSend: selectedLengths.join(',') || 'ë¹ˆ ë¬¸ìì—´'
            });
            searchParams.append('videoLength', selectedLengths.join(','));

            // ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬
            const selectedCategories = [];
            document.querySelectorAll('input[name="categories"]:checked').forEach(checkbox => {
                selectedCategories.push(checkbox.value);
            });
            
            console.log('ğŸ“š ì¹´í…Œê³ ë¦¬ ë””ë²„ê·¸:', {
                selectedCategories: selectedCategories,
                categoryCount: selectedCategories.length,
                joinedString: selectedCategories.join(','),
                willSend: selectedCategories.join(',') || 'ë¹ˆ ë¬¸ìì—´'
            });
            searchParams.append('categories', selectedCategories.join(','));

            // ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬
            const selectedSearchScope = [];
            document.querySelectorAll('input[name="searchScope"]:checked').forEach(checkbox => {
                selectedSearchScope.push(checkbox.value);
            });
            
            console.log('ğŸ” ê²€ìƒ‰ ë²”ìœ„ ë””ë²„ê·¸:', {
                selectedSearchScope: selectedSearchScope,
                scopeCount: selectedSearchScope.length,
                joinedString: selectedSearchScope.join(','),
                willSend: selectedSearchScope.join(',') || 'ë¹ˆ ë¬¸ìì—´'
            });
            searchParams.append('searchScope', selectedSearchScope.join(','));

            // í‚¤ì›Œë“œ í™•ì¸ ë° ì•ˆë‚´ ë©”ì‹œì§€
            const keyword = document.getElementById('keyword').value;
            // êµ­ê°€ ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬ (ìˆ˜ì •ë¨)
            const selectedCountries = [];
            document.querySelectorAll('input[name="countries"]:checked').forEach(checkbox => {
                selectedCountries.push(checkbox.value);
            });
            
            console.log('ğŸŒ ì„ íƒëœ êµ­ê°€ë“¤:', selectedCountries);
            searchParams.append('countries', selectedCountries.join(','));

            // ì‹œê°„ëŒ€ ì²´í¬ë°•ìŠ¤ ì²˜ë¦¬ (ìƒˆë¡œ ì¶”ê°€)
            const selectedTimezones = [];
            document.querySelectorAll('input[name="uploadTimezone"]:checked').forEach(checkbox => {
                selectedTimezones.push(checkbox.value);
            });
            
            console.log('ğŸ• ì„ íƒëœ ì‹œê°„ëŒ€ë“¤:', selectedTimezones);
            searchParams.append('uploadTimezone', selectedTimezones.join(','));
            const isEmptyKeyword = !keyword || !keyword.trim();
            
            console.log('=== í´ë¼ì´ì–¸íŠ¸ ê²€ìƒ‰ ìš”ì²­ ë””ë²„ê·¸ ===');
            console.log('ğŸŒ ì„ íƒëœ êµ­ê°€ë“¤:', selectedCountries);
            console.log('ğŸ• ì„ íƒëœ ì‹œê°„ëŒ€ë“¤:', selectedTimezones);
            console.log('ğŸ” ì…ë ¥ëœ í‚¤ì›Œë“œ:', keyword || 'ì—†ìŒ');
            console.log('ğŸ“‹ ê²€ìƒ‰ íŒŒë¼ë¯¸í„°:', searchParams.toString());
            console.log('===========================');
            
            if (isEmptyKeyword) {
                console.log('í‚¤ì›Œë“œ ì—†ìŒ: êµ­ê°€ë³„ ì¸ê¸° ë™ì˜ìƒ ê²€ìƒ‰ ëª¨ë“œ');
                if (selectedCountries.includes('worldwide')) {
                    showInfo('ğŸ”¥ í‚¤ì›Œë“œê°€ ì—†ì–´ì„œ ì „ì„¸ê³„ ì¡°íšŒìˆ˜ê°€ ë†’ì€ ì¸ê¸° ë™ì˜ìƒë“¤ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.');
                } else {
                    showInfo(`ğŸ”¥ í‚¤ì›Œë“œê°€ ì—†ì–´ì„œ ${selectedCountries.length}ê°œ êµ­ê°€ì˜ ì¸ê¸° ë™ì˜ìƒë“¤ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.`);
                }
            } else {
                console.log(`í‚¤ì›Œë“œ ê²€ìƒ‰: "${keyword.trim()}"`);
            }

            // UI ìƒíƒœ ì—…ë°ì´íŠ¸
            showLoading();
            hideError();
            hideResults();

            try {
                const response = await fetch(`/api/search?${searchParams.toString()}`);
                const data = await response.json();

                hideLoading();

                                 if (data.success) {
                     searchResults = data.data;
                     currentPage = 1;
                     
                     // ê²€ìƒ‰ ì‹œë§ˆë‹¤ ì •ë ¬ì„ ì¡°íšŒìˆ˜ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì´ˆê¸°í™”
                     sortColumn = 'daily_view_count';
                     sortDirection = 'desc';
                     
                     sortResults();
                     renderResults();
                     showResults();
                     
                     // ì¤‘ë³µ ì œê±° ì •ë³´ í‘œì‹œ (ì½˜ì†”ì—ë§Œ)
                     console.log(`âœ… ê²€ìƒ‰ ì™„ë£Œ: ${searchResults.length}ê°œ ê³ ìœ  ê²°ê³¼`);
                 } else {
                    // ì˜¤ë¥˜ íƒ€ì…ë³„ ì²˜ë¦¬
                    if (data.errorType === 'quota_exceeded') {
                        showError(`
                            <div style="text-align: center;">
                                <h3>ğŸš« YouTube API í• ë‹¹ëŸ‰ ì´ˆê³¼</h3>
                                <p><strong>${data.error}</strong></p>
                                <div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 0.9em;">
                                    ${data.details}
                                </div>
                                <div style="margin-top: 15px;">
                                    <p><strong>í•´ê²° ë°©ë²•:</strong></p>
                                    <ul style="text-align: left; display: inline-block;">
                                        <li>ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš” (í• ë‹¹ëŸ‰ ìë™ ì¬ì„¤ì •)</li>
                                        <li>ê´€ë¦¬ìì—ê²Œ API í‚¤ ì¶”ê°€ ìš”ì²­</li>
                                        <li>ê²€ìƒ‰ ë²”ìœ„ë¥¼ ì¤„ì—¬ì„œ ì¬ì‹œë„</li>
                                    </ul>
                                </div>
                            </div>
                        `);
                    } else if (data.errorType === 'invalid_api_key') {
                        showError(`
                            <div style="text-align: center;">
                                <h3>ğŸ”‘ API í‚¤ ì˜¤ë¥˜</h3>
                                <p><strong>${data.error}</strong></p>
                                <div style="margin-top: 15px;">
                                    <p>ê´€ë¦¬ìê°€ .env íŒŒì¼ì˜ YOUTUBE_API_KEYë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.</p>
                                </div>
                            </div>
                        `);
                    } else {
                        showError(data.error || 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                hideLoading();
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            }
        }

        // ì •ë ¬ í•¨ìˆ˜
        function sortResults() {
            searchResults.sort((a, b) => {
                let aVal = a[sortColumn];
                let bVal = b[sortColumn];

                // ìˆ«ì ê°’ ì²˜ë¦¬
                if (sortColumn === 'daily_view_count' || sortColumn === 'subscriber_count') {
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                }

                // ë™ì˜ìƒ ì‹œê°„ ì²˜ë¦¬
                if (sortColumn === 'duration') {
                    aVal = parseInt(a.duration_seconds) || 0;
                    bVal = parseInt(b.duration_seconds) || 0;
                }

                // ë‚ ì§œ ê°’ ì²˜ë¦¬
                if (sortColumn === 'status_date') {
                    aVal = new Date(aVal);
                    bVal = new Date(bVal);
                }

                // ë¬¸ìì—´ ê°’ ì²˜ë¦¬
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
        }

        // ê²°ê³¼ ë Œë”ë§ í•¨ìˆ˜
        function renderResults() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageResults = searchResults.slice(startIndex, endIndex);

            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';

            if (pageResults.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="no-results">
                            <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p>ë‹¤ë¥¸ ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            pageResults.forEach(result => {
                const row = document.createElement('tr');
                
                // ì‹œê°„ ì •ë³´ ì²˜ë¦¬
                const uploadDateObj = new Date(result.status_date);
                
                // í˜„ì§€ì‹œê°„ ì •ë³´ (ê°€ì •: ì„ íƒëœ êµ­ê°€ì˜ ì‹œê°„ëŒ€)
                const localTimeData = formatLocalTime(uploadDateObj, getSelectedCountry());
                
                // í•œêµ­ì‹œê°„ ì •ë³´ (UTC+9)
                const koreaTimeData = formatKoreaTime(uploadDateObj);
                
                const viewCount = formatViewCount(result.daily_view_count);
                const subscriberCount = formatSubscriberCount(result.subscriber_count || 0);
                const formattedDuration = formatDuration(result.duration_seconds);
                
                row.innerHTML = `
                    <td>
                        <img src="${result.thumbnail_url}" alt="ì¸ë„¤ì¼" class="thumbnail">
                    </td>
                    <td>
                        <a href="https://www.youtube.com/channel/${result.youtube_channel_id}" target="_blank" class="channel-link" title="${result.youtube_channel_name} ì±„ë„ í™ˆìœ¼ë¡œ ì´ë™">
                            <div class="channel-name">
                                ${result.youtube_channel_name}
                            </div>
                        </a>
                    </td>
                    <td>
                        <div class="video-title" title="${result.title}">
                            ${result.title}
                        </div>
                    </td>
                    <td>${result.primary_category}</td>
                    <td>
                        <div class="time-display">
                            <div class="date-line">${localTimeData.date}</div>
                            <div class="day-line">${localTimeData.countryDay}</div>
                            <div class="time-line ${localTimeData.viralClass}">${localTimeData.time}</div>
                        </div>
                    </td>
                    <td>
                        <div class="time-display">
                            <div class="date-line">${koreaTimeData.date}</div>
                            <div class="day-line">${koreaTimeData.countryDay}</div>
                            <div class="time-line ${koreaTimeData.viralClass}">${koreaTimeData.time}</div>
                        </div>
                    </td>
                    <td>
                        <span class="view-count">${viewCount}</span>
                    </td>
                    <td>
                        <span class="subscriber-count">${subscriberCount}</span>
                    </td>
                    <td>
                        <a href="javascript:void(0)" onclick="openVideoWithCopy('${result.vod_url}')" class="video-link" title="ë™ì˜ìƒ ì—´ê¸° + URL ë³µì‚¬">
                            â–¶ï¸
                        </a>
                    </td>
                    <td>
                        <span class="duration-time" title="${result.duration_seconds}ì´ˆ">${formattedDuration}</span>
                    </td>
                    <td>
                        <button class="download-btn" onclick="downloadThumbnail('${result.thumbnail_url}', '${result.youtube_channel_name}')" title="í´ë¦­í•˜ë©´ ì €ì¥ ìœ„ì¹˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤">
                            â¬‡ï¸ 
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });

            // ê²°ê³¼ ìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('resultsCount').textContent = searchResults.length;

            // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
            renderPagination();

            // ì •ë ¬ í—¤ë” ì—…ë°ì´íŠ¸
            updateSortHeaders();
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§ í•¨ìˆ˜
        function renderPagination() {
            const totalPages = Math.ceil(searchResults.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (totalPages <= 1) return;

            // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'ì´ì „';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => changePage(currentPage - 1);
            pagination.appendChild(prevBtn);

            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                const btn = document.createElement('button');
                btn.textContent = '1';
                btn.onclick = () => changePage(1);
                pagination.appendChild(btn);

                if (startPage > 2) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    pagination.appendChild(dots);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.onclick = () => changePage(i);
                pagination.appendChild(btn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    pagination.appendChild(dots);
                }

                const btn = document.createElement('button');
                btn.textContent = totalPages;
                btn.onclick = () => changePage(totalPages);
                pagination.appendChild(btn);
            }

            // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'ë‹¤ìŒ';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => changePage(currentPage + 1);
            pagination.appendChild(nextBtn);

            // í˜ì´ì§€ ì •ë³´
            const pageInfo = document.createElement('div');
            pageInfo.className = 'page-info';
            pageInfo.textContent = `${currentPage} / ${totalPages} í˜ì´ì§€`;
            pagination.appendChild(pageInfo);
        }

        // í˜ì´ì§€ ë³€ê²½ í•¨ìˆ˜
        function changePage(newPage) {
            const totalPages = Math.ceil(searchResults.length / itemsPerPage);
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderResults();
            }
        }

        // ì •ë ¬ í—¤ë” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSortHeaders() {
            document.querySelectorAll('.results-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.dataset.sort === sortColumn) {
                    th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
        }

        // í…Œì´ë¸” í—¤ë” í´ë¦­ ì´ë²¤íŠ¸ (ì •ë ¬)
        document.querySelectorAll('.results-table th.sortable').forEach(th => {
            th.addEventListener('click', () => {
                const column = th.dataset.sort;
                if (sortColumn === column) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = column;
                    sortDirection = 'desc';
                }
                sortResults();
                renderResults();
            });
        });



        // UI ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showLoading() {
            document.getElementById('loadingIndicator').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = message; // innerHTMLë¡œ ë³€ê²½í•˜ì—¬ HTML íƒœê·¸ ì§€ì›
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showInfo(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `<div style="background: #e3f2fd; color: #0277bd; border: 1px solid #81d4fa; border-radius: 8px; padding: 15px; margin: 10px 0;">${message}</div>`;
            errorDiv.style.display = 'block';
            
            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ìˆ¨ê¹€
            setTimeout(() => {
                hideError();
            }, 3000);
        }

        function showResults() {
            document.getElementById('resultsContainer').style.display = 'block';
            // Excel ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('downloadExcelBtn').style.display = 'flex';
        }

        function hideResults() {
            document.getElementById('resultsContainer').style.display = 'none';
            // Excel ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìˆ¨ê¹€
            document.getElementById('downloadExcelBtn').style.display = 'none';
        }

        // Excel ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadExcel() {
            if (!searchResults || searchResults.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                const downloadBtn = document.getElementById('downloadExcelBtn');
                const originalText = downloadBtn.textContent;
                
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                downloadBtn.disabled = true;
                downloadBtn.textContent = 'ğŸ“Š ~';

                // í˜„ì¬ ê²€ìƒ‰ ì¡°ê±´ ìˆ˜ì§‘
                const rawStartDate = document.getElementById('startDate').value;
                const rawEndDate = document.getElementById('endDate').value;
                
                // ë‚ ì§œ ìœ íš¨ì„± ê²€ì¦
                let validStartDate = null;
                let validEndDate = null;
                
                if (rawStartDate) {
                    try {
                        const testDate = new Date(rawStartDate);
                        if (!isNaN(testDate.getTime()) && rawStartDate.match(/^\d{4}-\d{2}-\d{2}$/)) {
                            validStartDate = rawStartDate;
                        }
                    } catch (error) {
                        console.error('Excel: ì‹œì‘ì¼ ê²€ì¦ ì˜¤ë¥˜:', error.message);
                    }
                }
                
                if (rawEndDate) {
                    try {
                        const testDate = new Date(rawEndDate);
                        if (!isNaN(testDate.getTime()) && rawEndDate.match(/^\d{4}-\d{2}-\d{2}$/)) {
                            validEndDate = rawEndDate;
                        }
                    } catch (error) {
                        console.error('Excel: ì¢…ë£Œì¼ ê²€ì¦ ì˜¤ë¥˜:', error.message);
                    }
                }
                
                const searchParams = {
                    keyword: document.getElementById('keyword').value || 'ì „ì²´',
                    country: document.getElementById('country').value || 'worldwide',
                    minViews: document.getElementById('minViews').value,
                    maxViews: document.getElementById('maxViews').value,
                    uploadPeriod: document.getElementById('uploadPeriod').value,
                    startDate: validStartDate,
                    endDate: validEndDate,
                    maxResults: document.getElementById('maxResults').value
                };

                // Excel ìƒì„±ì— í•„ìš”í•œ ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ì—¬ í˜ì´ë¡œë“œ í¬ê¸° ìµœì í™”
                const optimizedResults = searchResults.map(result => ({
                    youtube_channel_name: result.youtube_channel_name,
                    thumbnail_url: result.thumbnail_url,
                    status: result.status,
                    youtube_channel_id: result.youtube_channel_id,
                    title: result.title,
                    daily_view_count: result.daily_view_count,
                    subscriber_count: result.subscriber_count,
                    vod_url: result.vod_url,
                    status_date: result.status_date,
                    duration_seconds: result.duration_seconds,
                    video_length_category: result.video_length_category,
                    primary_category: result.primary_category
                }));

                console.log('Excel ë‹¤ìš´ë¡œë“œ ìš”ì²­:', {
                    resultsCount: optimizedResults.length,
                    originalSize: JSON.stringify(searchResults).length,
                    optimizedSize: JSON.stringify(optimizedResults).length,
                    searchParams: searchParams
                });

                // ì„œë²„ì— Excel ìƒì„± ìš”ì²­
                const response = await fetch('/api/download-excel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        searchResults: optimizedResults,
                        searchParams: searchParams
                    })
                });

                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }

                // íŒŒì¼ëª…ì„ ì‘ë‹µ í—¤ë”ì—ì„œ ì¶”ì¶œí•˜ê±°ë‚˜ ê¸°ë³¸ê°’ ì‚¬ìš©
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'YouTube_ê²€ìƒ‰ê²°ê³¼.xlsx';
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                    if (filenameMatch) {
                        filename = decodeURIComponent(filenameMatch[1].replace(/['"]/g, ''));
                    }
                }

                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ (í´ë” ì„ íƒ ê°€ëŠ¥)
                const blob = await response.blob();
                await downloadExcelWithFolderChoice(blob, filename);

                console.log(`âœ… Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${filename}`);
                
                // alert ì°½ì„ í‘œì‹œí•˜ê³ , í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„ì— ë²„íŠ¼ ìƒíƒœ ë³µì›
                alert(`âœ… Excel íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\níŒŒì¼ëª…: ${filename}\në°ì´í„°: ${searchResults.length}í–‰`);
                
                // alert ì°½ì´ ë‹«íŒ í›„ì— ë²„íŠ¼ ìƒíƒœ ë³µì›
                downloadBtn.disabled = false;
                downloadBtn.textContent = originalText;

            } catch (error) {
                console.error('Excel ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ alert ì°½ì´ ë‹«íŒ í›„ì— ë²„íŠ¼ ìƒíƒœ ë³µì›
                downloadBtn.disabled = false;
                downloadBtn.textContent = originalText;
            }
        }

        // Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œ (í´ë” ì„ íƒ ê°€ëŠ¥)
        async function downloadExcelWithFolderChoice(blob, filename) {
            try {
                // ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œ File System Access API ì§€ì› í™•ì¸
                if ('showSaveFilePicker' in window) {
                    // File System Access API ì‚¬ìš© (Chrome 86+, Edge 86+)
                    await downloadExcelWithFilePicker(blob, filename);
                } else if ('showDirectoryPicker' in window) {
                    // Directory Picker API ì‚¬ìš© (ëŒ€ì²´ ë°©ë²•)
                    await downloadExcelWithDirectoryPicker(blob, filename);
                } else {
                    // ê¸°ì¡´ ë°©ì‹ (ìë™ ë‹¤ìš´ë¡œë“œ) - ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•œ fallback
                    await downloadExcelWithTraditionalMethod(blob, filename);
                }
            } catch (error) {
                console.error('Excel ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ë°©ì‹ìœ¼ë¡œ fallback
                await downloadExcelWithTraditionalMethod(blob, filename);
            }
        }

        // File System Access APIë¥¼ ì‚¬ìš©í•œ Excel íŒŒì¼ ì €ì¥ (ìœ„ì¹˜ ì„ íƒ ê°€ëŠ¥)
        async function downloadExcelWithFilePicker(blob, filename) {
            try {
                // íŒŒì¼ ì €ì¥ ìœ„ì¹˜ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
                const fileHandle = await window.showSaveFilePicker({
                    suggestedName: filename,
                    types: [{
                        description: 'Excel íŒŒì¼',
                        accept: {
                            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],
                            'application/vnd.ms-excel': ['.xls']
                        }
                    }]
                });

                // ì„ íƒí•œ ìœ„ì¹˜ì— íŒŒì¼ ì €ì¥
                const writable = await fileHandle.createWritable();
                await writable.write(blob);
                await writable.close();
                
                console.log(`âœ… Excel íŒŒì¼ì´ ì„ íƒí•œ ìœ„ì¹˜ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${filename}`);
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('ì‚¬ìš©ìê°€ ì €ì¥ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                    throw new Error('ì €ì¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    throw error;
                }
            }
        }

        // Directory Picker APIë¥¼ ì‚¬ìš©í•œ Excel íŒŒì¼ ì €ì¥
        async function downloadExcelWithDirectoryPicker(blob, filename) {
            try {
                // í´ë” ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
                const dirHandle = await window.showDirectoryPicker();
                
                // ì„ íƒí•œ í´ë”ì— íŒŒì¼ ìƒì„± ë° ì €ì¥
                const fileHandle = await dirHandle.getFileHandle(filename, { create: true });
                const writable = await fileHandle.createWritable();
                await writable.write(blob);
                await writable.close();
                
                console.log(`âœ… Excel íŒŒì¼ì´ ì„ íƒí•œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${filename}`);
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('ì‚¬ìš©ìê°€ í´ë” ì„ íƒì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
                    throw new Error('í´ë” ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    throw error;
                }
            }
        }

        // ê¸°ì¡´ ë°©ì‹ Excel ë‹¤ìš´ë¡œë“œ (ë¸Œë¼ìš°ì € í˜¸í™˜ì„± fallback)
        async function downloadExcelWithTraditionalMethod(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            console.log(`ğŸ“ Excel íŒŒì¼ì´ ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤: ${filename}`);
        }

        // ì¡°íšŒìˆ˜ë¥¼ ì›ë˜ ìˆ«ì ê·¸ëŒ€ë¡œ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function formatViewCount(count) {
            if (!count || count === 0) {
                return '0';
            }
            
            const number = parseInt(count);
            return number.toLocaleString();
        }

        // êµ¬ë…ì ìˆ˜ë¥¼ ë§Œ ë‹¨ìœ„ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function formatSubscriberCount(count) {
            if (!count || count === 0) {
                return '0';
            }
            
            const number = parseInt(count);
            const inTenThousands = number / 10000;
            
            if (number < 10000) {
                // 1ë§Œ ë¯¸ë§Œì¸ ê²½ìš° ì†Œìˆ˜ì  2ìë¦¬ í‘œì‹œ
                return inTenThousands.toFixed(2);
            } else {
                // 1ë§Œ ì´ìƒì¸ ê²½ìš° ì†Œìˆ˜ì  1ìë¦¬ í‘œì‹œ (100ë§Œ ì´ìƒë„ í¬í•¨)
                return inTenThousands.toFixed(1);
            }
        }

        // ë™ì˜ìƒ ì¬ìƒì‹œê°„ì„ HH:MM:SS í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function formatDuration(durationSeconds) {
            if (!durationSeconds || durationSeconds === 0) {
                // 0ì´ˆì¸ ê²½ìš° ë¼ì´ë¸Œ ë˜ëŠ” ì—°ì† ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ íŒë‹¨
                return 'LIVE';
            }
            
            const hours = Math.floor(durationSeconds / 3600);
            const minutes = Math.floor((durationSeconds % 3600) / 60);
            const seconds = durationSeconds % 60;
            
            if (hours > 0) {
                // 1ì‹œê°„ ì´ìƒì¸ ê²½ìš°: HH:MM:SS í˜•ì‹
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                // 1ì‹œê°„ ë¯¸ë§Œì¸ ê²½ìš°: MM:SS í˜•ì‹
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // ë™ì˜ìƒ ë§í¬ í´ë¦­ ì‹œ URL ë³µì‚¬ ë° ìƒˆ íƒ­ ì—´ê¸°
        function openVideoWithCopy(videoUrl) {
            try {
                // URLì„ í´ë¦½ë³´ë“œì— ë³µì‚¬
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(videoUrl).then(() => {
                        console.log('ë™ì˜ìƒ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:', videoUrl);
                    }).catch(err => {
                        console.log('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                    });
                } else {
                    // êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›
                    const textArea = document.createElement('textarea');
                    textArea.value = videoUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        console.log('ë™ì˜ìƒ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ (fallback):', videoUrl);
                    } catch (fallbackErr) {
                        console.log('URL ë³µì‚¬ fallback ì‹¤íŒ¨:', fallbackErr);
                    }
                    document.body.removeChild(textArea);
                }
                
                // ìƒˆ íƒ­ì—ì„œ ë™ì˜ìƒ ì—´ê¸°
                window.open(videoUrl, '_blank');
                
                console.log('ë™ì˜ìƒ ë§í¬ ì—´ê¸°:', videoUrl);
            } catch (error) {
                console.error('ë™ì˜ìƒ ë§í¬ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ìµœì†Œí•œ ë§í¬ëŠ” ì—´ê¸°
                window.open(videoUrl, '_blank');
            }
        }

        // ë™ì˜ìƒ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ (í™”ì§ˆ ì„ íƒ ëª¨ë‹¬ ì—´ê¸°)
        let currentVideoUrl = '';
        let currentVideoTitle = '';
        let selectedQuality = '';
        
        function downloadVideo(videoUrl, videoTitle) {
            try {
                currentVideoUrl = videoUrl;
                currentVideoTitle = videoTitle;
                
                // í™”ì§ˆ ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
                document.getElementById('qualityModal').style.display = 'block';
                
            } catch (error) {
                console.error('ë™ì˜ìƒ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ë™ì˜ìƒ ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í™”ì§ˆ ì„ íƒ í•¨ìˆ˜
        function selectQuality(quality) {
            selectedQuality = quality;
            
            // í™”ì§ˆì— ë”°ë¥¸ ë‹¤ìš´ë¡œë“œ ì•ˆë‚´ ë©”ì‹œì§€ ìƒì„±
            let qualityText = '';
            let downloadTips = '';
            
            switch(quality) {
                case '4K':
                    qualityText = '4K (2160p) ìµœê³  í™”ì§ˆ';
                    downloadTips = 'ìµœê³  í™”ì§ˆë¡œ í¬ê¸°ê°€ ë§¤ìš° í´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Wi-Fi í™˜ê²½ì—ì„œ ë‹¤ìš´ë¡œë“œë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.';
                    break;
                case '1080p':
                    qualityText = 'Full HD (1080p) ê³ í™”ì§ˆ';
                    downloadTips = 'ê°€ì¥ ì¸ê¸° ìˆëŠ” í™”ì§ˆë¡œ í™”ì§ˆê³¼ íŒŒì¼ í¬ê¸°ì˜ ë°”ë€ìŠ¤ê°€ ì¢‹ìŠµë‹ˆë‹¤.';
                    break;
                case '720p':
                    qualityText = 'HD (720p) ì¤‘ê°„ í™”ì§ˆ';
                    downloadTips = 'ë¹ ë¥¸ ë‹¤ìš´ë¡œë“œê°€ ê°€ëŠ¥í•˜ë©° ëŒ€ë¶€ë¶„ì˜ ê¸°ê¸°ì—ì„œ ì›í™œí•˜ê²Œ ì¬ìƒë©ë‹ˆë‹¤.';
                    break;
                case '480p':
                    qualityText = 'SD (480p) ê¸°ë³¸ í™”ì§ˆ';
                    downloadTips = 'ì‘ì€ íŒŒì¼ í¬ê¸°ë¡œ ë°ì´í„° ì ˆì•½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
                    break;
                case '360p':
                    qualityText = 'Low (360p) ë‚®ì€ í™”ì§ˆ';
                    downloadTips = 'ë°°ê²½ ì¬ìƒì´ë‚˜ ìŒì„± ìœ„ì£¼ì˜ ì½˜í…ì¸ ì— ì í•©í•©ë‹ˆë‹¤.';
                    break;
                case 'audio':
                    qualityText = 'ì˜¤ë””ì˜¤ë§Œ (MP3/M4A)';
                    downloadTips = 'ìŒì•…, íŒŸì»¬ìŠ¤íŠ¸, ê°•ì˜ ë“± ìŒì„±ë§Œ í•„ìš”í•œ ê²½ìš°ì— ì í•©í•©ë‹ˆë‹¤.';
                    break;
            }
            
            const message = `ì„ íƒí•œ í™”ì§ˆ: ${qualityText}\n\n` +
                `ë™ì˜ìƒ: ${currentVideoTitle}\n\n` +
                `íŒ: ${downloadTips}\n\n` +
                `ì¶”ì²œ ë‹¤ìš´ë¡œë”:\n` +
                `1. yt-dlp (GitHub) - ìµœê³  ì„±ëŠ¥\n` +
                `2. 4K Video Downloader - ê°„í¸í•œ UI\n` +
                `3. ClipGrab - ì‚¬ìš© ì‰¬ì›€\n\n` +
                `ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤:\n` +
                `- savefrom.net\n` +
                `- y2mate.com\n` +
                `- keepvid.com\n\n` +
                `ì£¼ì˜: ì €ì‘ê¶Œ ë²•ë¥ ì„ ì¤€ìˆ˜í•˜ì—¬ ê°œì¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.`;
            
            alert(message);
            
            // URL ìë™ ë³µì‚¬
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(currentVideoUrl).then(() => {
                    console.log('ë™ì˜ìƒ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }).catch(err => {
                    console.log('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                });
            }
            
            // ë™ì˜ìƒ í˜ì´ì§€ë¥¼ ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
            window.open(currentVideoUrl, '_blank');
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeQualityModal();
        }
        
        // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeQualityModal() {
            document.getElementById('qualityModal').style.display = 'none';
            currentVideoUrl = '';
            currentVideoTitle = '';
            selectedQuality = '';
        }
        
        // URL ë³µì‚¬ í›„ ëª¨ë‹¬ ë‹«ê¸°
        function copyVideoUrl() {
            if (currentVideoUrl) {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(currentVideoUrl).then(() => {
                        alert('ë™ì˜ìƒ URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        closeQualityModal();
                    }).catch(err => {
                        alert('URL ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        console.log('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                    });
                } else {
                    // í´ë¦½ë³´ë“œ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°
                    alert(`URLì„ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•˜ì„¸ìš”:\n\n${currentVideoUrl}`);
                    closeQualityModal();
                }
            }
        }
        



        // ë™ì˜ìƒ ë§í¬ í´ë¦­ ì‹œ URL ë³µì‚¬ + ìƒˆ íƒ­ ì—´ê¸° í•¨ìˆ˜
        function openVideoWithCopy(videoUrl) {
            try {
                // 1. í´ë¦½ë³´ë“œì— URL ë³µì‚¬
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(videoUrl).then(() => {
                        console.log('âœ… URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:', videoUrl);
                        
                        // ë³µì‚¬ ì„±ê³µì„ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ (ì„ íƒì )
                        showCopyNotification('URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }).catch(err => {
                        console.warn('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                        // ë³µì‚¬ ì‹¤íŒ¨ ì‹œì—ë„ ë§í¬ëŠ” ì—´ê¸°
                        showCopyNotification('ë§í¬ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤ (URL ë³µì‚¬ëŠ” ì‹¤íŒ¨)', 'warning');
                    });
                } else {
                    // í´ë¦½ë³´ë“œ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°
                    console.warn('í´ë¦½ë³´ë“œ API ë¯¸ì§€ì› - URL ë³µì‚¬ ê±´ë„ˆë›°ê¸°');
                    showCopyNotification('ë§í¬ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤ (ë¸Œë¼ìš°ì €ê°€ ìë™ë³µì‚¬ ë¯¸ì§€ì›)', 'info');
                }
                
                // 2. ìƒˆ íƒ­ì—ì„œ YouTube í˜ì´ì§€ ì—´ê¸°
                window.open(videoUrl, '_blank');
                
            } catch (error) {
                console.error('ë§í¬ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ìµœì†Œí•œ ë§í¬ëŠ” ì—´ê¸°
                window.open(videoUrl, '_blank');
            }
        }
        
        // URL ë³µì‚¬ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showCopyNotification(message, type = 'success') {
            // ê¸°ì¡´ ì•Œë¦¼ì´ ìˆìœ¼ë©´ ì œê±°
            const existingNotification = document.getElementById('copyNotification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // ìƒˆ ì•Œë¦¼ ìƒì„±
            const notification = document.createElement('div');
            notification.id = 'copyNotification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 500;
                font-size: 14px;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transform: translateX(100%);
                transition: transform 0.3s ease-in-out;
                cursor: pointer;
            `;
            
            // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
            if (type === 'success') {
                notification.style.backgroundColor = '#d4edda';
                notification.style.color = '#155724';
                notification.style.border = '1px solid #c3e6cb';
                notification.innerHTML = `âœ… ${message}`;
            } else if (type === 'warning') {
                notification.style.backgroundColor = '#fff3cd';
                notification.style.color = '#856404';
                notification.style.border = '1px solid #ffeaa7';
                notification.innerHTML = `âš ï¸ ${message}`;
            } else if (type === 'info') {
                notification.style.backgroundColor = '#e3f2fd';
                notification.style.color = '#0277bd';
                notification.style.border = '1px solid #81d4fa';
                notification.innerHTML = `â„¹ï¸ ${message}`;
            }
            
            // í˜ì´ì§€ì— ì¶”ê°€
            document.body.appendChild(notification);
            
            // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // í´ë¦­ ì‹œ ì¦‰ì‹œ ì œê±°
            notification.addEventListener('click', () => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            });
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // ê²€ìƒ‰ ë²”ìœ„ ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥
        document.getElementById('searchScopeDisplay').addEventListener('click', () => {
            const dropdown = document.getElementById('searchScopeDropdown');
            dropdown.classList.toggle('show');
        });

        // ëª¨ë“  ê²€ìƒ‰ ë²”ìœ„ ì„ íƒ/í•´ì œ
        document.getElementById('selectAllSearchScope').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]');
            
            searchScopeCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateSearchScopeDisplay();
        });

        // ê°œë³„ ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.querySelectorAll('input[name="searchScope"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                updateSelectAllSearchScope();
                updateSearchScopeDisplay();
            });
        });

        // ê²€ìƒ‰ ë²”ìœ„ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSearchScopeDisplay() {
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]:checked');
            const display = document.getElementById('searchScopeDisplay');
            
            if (searchScopeCheckboxes.length === 0) {
                display.textContent = 'ê²€ìƒ‰ ë²”ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            } else if (searchScopeCheckboxes.length === document.querySelectorAll('input[name="searchScope"]').length) {
                display.textContent = 'ëª¨ë“  ë²”ìœ„ ì„ íƒë¨';
            } else {
                const selectedNames = Array.from(searchScopeCheckboxes).map(cb => {
                    const label = cb.parentElement.querySelector('label');
                    return label.textContent;
                });
                display.textContent = selectedNames.join(', ') + ' ì„ íƒë¨';
            }
        }

        // ëª¨ë“  ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllSearchScope() {
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]');
            const checkedSearchScope = document.querySelectorAll('input[name="searchScope"]:checked');
            const selectAllCheckbox = document.getElementById('selectAllSearchScope');
            
            if (checkedSearchScope.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedSearchScope.length === searchScopeCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // ê²€ìƒ‰ ë²”ìœ„ ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥
        document.getElementById('searchScopeDisplay').addEventListener('click', () => {
            const dropdown = document.getElementById('searchScopeDropdown');
            dropdown.classList.toggle('show');
        });

        // ëª¨ë“  ê²€ìƒ‰ ë²”ìœ„ ì„ íƒ/í•´ì œ
        document.getElementById('selectAllSearchScope').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]');
            
            searchScopeCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateSearchScopeDisplay();
        });

        // ê°œë³„ ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.querySelectorAll('input[name="searchScope"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                updateSelectAllSearchScope();
                updateSearchScopeDisplay();
            });
        });

        // ê²€ìƒ‰ ë²”ìœ„ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSearchScopeDisplay() {
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]:checked');
            const display = document.getElementById('searchScopeDisplay');
            
            if (searchScopeCheckboxes.length === 0) {
                display.textContent = 'ê²€ìƒ‰ ë²”ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            } else if (searchScopeCheckboxes.length === document.querySelectorAll('input[name="searchScope"]').length) {
                display.textContent = 'ëª¨ë“  ë²”ìœ„ ì„ íƒë¨';
            } else {
                const selectedNames = Array.from(searchScopeCheckboxes).map(cb => {
                    const label = cb.parentElement.querySelector('label');
                    return label.textContent;
                });
                display.textContent = selectedNames.join(', ') + ' ì„ íƒë¨';
            }
        }

        // ëª¨ë“  ê²€ìƒ‰ ë²”ìœ„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllSearchScope() {
            const searchScopeCheckboxes = document.querySelectorAll('input[name="searchScope"]');
            const checkedSearchScope = document.querySelectorAll('input[name="searchScope"]:checked');
            const selectAllCheckbox = document.getElementById('selectAllSearchScope');
            
            if (checkedSearchScope.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedSearchScope.length === searchScopeCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥ (DOMContentLoadedì—ì„œ ì„¤ì •ë¨)
        
        // ë¬¸ì„œ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            // ê²€ìƒ‰ ë²”ìœ„ ë“œë¡­ë‹¤ìš´ ì²˜ë¦¬
            const searchScopeDisplay = document.getElementById('searchScopeDisplay');
            const searchScopeDropdown = document.getElementById('searchScopeDropdown');
            
            if (searchScopeDisplay && searchScopeDropdown) {
                const searchScopeSelector = searchScopeDisplay.closest('.category-selector');
                if (searchScopeSelector && !searchScopeSelector.contains(e.target)) {
                    searchScopeDropdown.classList.remove('show');
                }
            }
            
            // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì²˜ë¦¬
            const categoryDisplay = document.getElementById('categoryDisplay');
            const categoryDropdown = document.getElementById('categoryDropdown');
            
            if (categoryDisplay && categoryDropdown) {
                const categorySelector = categoryDisplay.closest('.category-selector');
                if (categorySelector && !categorySelector.contains(e.target)) {
                    categoryDropdown.classList.remove('show');
                }
            }
        });

        // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì„ íƒ/í•´ì œ
        document.getElementById('selectAllCategories').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            const categoryCheckboxes = document.querySelectorAll('input[name="categories"]');
            
            categoryCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateCategoryDisplay();
        });

        // ê°œë³„ ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.querySelectorAll('input[name="categories"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                updateSelectAllCategories();
                updateCategoryDisplay();
            });
        });

        // ì¹´í…Œê³ ë¦¬ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCategoryDisplay() {
            const categoryCheckboxes = document.querySelectorAll('input[name="categories"]:checked');
            const display = document.getElementById('categoryDisplay');
            
            if (categoryCheckboxes.length === 0) {
                display.textContent = 'ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            } else if (categoryCheckboxes.length === document.querySelectorAll('input[name="categories"]').length) {
                display.textContent = 'ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì„ íƒë¨';
            } else if (categoryCheckboxes.length <= 3) {
                const selectedNames = Array.from(categoryCheckboxes).map(cb => {
                    const label = cb.parentElement.querySelector('label');
                    return label.textContent;
                });
                display.textContent = selectedNames.join(', ');
            } else {
                display.textContent = `${categoryCheckboxes.length}ê°œ ì¹´í…Œê³ ë¦¬ ì„ íƒë¨`;
            }
        }

        // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllCategories() {
            const categoryCheckboxes = document.querySelectorAll('input[name="categories"]');
            const checkedCategories = document.querySelectorAll('input[name="categories"]:checked');
            const selectAllCheckbox = document.getElementById('selectAllCategories');
            
            if (checkedCategories.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCategories.length === categoryCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ í´ë¦­ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ (ê°„ì†Œí™”)
        function categoryDisplayClickHandler() {
            const dropdown = document.getElementById('categoryDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function categoryDisplayKeyHandler(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                categoryDisplayClickHandler();
            }
        }
        
        // êµ­ê°€ ë“œë¡­ë‹¤ìš´ í´ë¦­ í•¸ë“¤ëŸ¬ í•¨ìˆ˜
        function countryDisplayClickHandler() {
            const dropdown = document.getElementById('countryDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
                console.log('êµ­ê°€ ë“œë¡­ë‹¤ìš´ í´ë¦­ë¨, show í´ë˜ìŠ¤:', dropdown.classList.contains('show'));
            }
        }
        
        // êµ­ê°€ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function countryDisplayKeyHandler(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                countryDisplayClickHandler();
            }
        }

        // êµ­ê°€ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCountryDisplay() {
            const countryCheckboxes = document.querySelectorAll('input[name="countries"]:checked');
            const display = document.getElementById('countryDisplay');
            
            if (countryCheckboxes.length === 0) {
                display.textContent = 'êµ­ê°€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            } else if (countryCheckboxes.length === document.querySelectorAll('input[name="countries"]').length) {
                display.textContent = 'ëª¨ë“  êµ­ê°€ ì„ íƒë¨';
            } else if (countryCheckboxes.length <= 3) {
                const selectedNames = Array.from(countryCheckboxes).map(cb => {
                    const label = cb.parentElement.querySelector('label');
                    return label.textContent;
                });
                display.textContent = selectedNames.join(', ');
            } else {
                display.textContent = `${countryCheckboxes.length}ê°œ êµ­ê°€ ì„ íƒë¨`;
            }
        }

        // ëª¨ë“  êµ­ê°€ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllCountries() {
            const countryCheckboxes = document.querySelectorAll('input[name="countries"]');
            const checkedCountries = document.querySelectorAll('input[name="countries"]:checked');
            const selectAllCheckbox = document.getElementById('selectAllCountries');
            
            if (checkedCountries.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCountries.length === countryCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // êµ­ê°€ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™” í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        function initializeCountryCheckboxes() {
            // êµ­ê°€ "ëª¨ë“  êµ­ê°€" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            const selectAllCountriesCheckbox = document.getElementById('selectAllCountries');
            if (selectAllCountriesCheckbox) {
                selectAllCountriesCheckbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    const countryCheckboxes = document.querySelectorAll('input[name="countries"]');
                    
                    countryCheckboxes.forEach(checkbox => {
                        checkbox.checked = isChecked;
                    });
                    
                    updateCountryDisplay();
                });
            }

            // ê°œë³„ êµ­ê°€ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            const countryCheckboxes = document.querySelectorAll('input[name="countries"]');
            countryCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateSelectAllCountries();
                    updateCountryDisplay();
                });
            });
            
            console.log('âœ… êµ­ê°€ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë“±ë¡ ì™„ë£Œ:', countryCheckboxes.length + 'ê°œ');
        }
        
        // ì‹œê°„ëŒ€ í•„í„° ì´ˆê¸°í™”
        function initializeTimezoneFilters() {
            // ì‹œê°„ëŒ€ "ëª¨ë‘ ì„ íƒ" ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.getElementById('selectAllTimezone').addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                const timezoneCheckboxes = [
                    // ê¸€ë¡œë²Œ & ë²”ìš©
                    'timezoneGlobalSweet', 'timezoneShortsPeak', 'timezoneWeekend',
                    // ì•„ì‹œì•„-íƒœí‰ì–‘
                    'timezoneKrGolden', 'timezoneJpPrime', 'timezoneInPrime', 'timezoneThGolden', 
                    'timezoneVnEvening', 'timezoneIdPrime', 'timezoneAuPrime', 'timezoneCnEvening',
                    // ë¶ë¯¸
                    'timezoneUsEast', 'timezoneUsWest', 'timezoneCaPrime', 'timezoneMxPrime',
                    // ìœ ëŸ½
                    'timezoneGbPrime', 'timezoneDePrime', 'timezoneFrEvening', 'timezoneEsPrime', 'timezoneItPrime',
                    // ë‚¨ë¯¸
                    'timezoneBrPrime', 'timezoneArPrime', 'timezoneCoPrime',
                    // ì¤‘ë™ & ì•„í”„ë¦¬ì¹´
                    'timezoneSaPrime', 'timezoneAePrime', 'timezoneZaPrime', 'timezoneNgPrime', 'timezoneEgPrime',
                    // ê¸°íƒ€
                    'timezoneRuPrime',
                    // í•œêµ­ ì„¸ë¶€
                    'timezoneKrLunch', 'timezoneKrNight', 'timezoneKrMorning'
                ];
                
                timezoneCheckboxes.forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = isChecked;
                    }
                });
                
                updateTimezoneGroupCheckboxes();
            });

            // ì‹œê°„ëŒ€ "ê³¨ë“ íƒ€ì„" ê·¸ë£¹ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ (ì—…ë°ì´íŠ¸ë¨)
            document.getElementById('selectGoldenTime').addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                const goldenTimeCheckboxes = [
                    'timezoneGlobalSweet', 'timezoneShortsPeak', 'timezoneWeekend',
                    'timezoneKrGolden', 'timezoneUsEast', 'timezoneGbPrime', 'timezoneBrPrime'
                ];
                
                goldenTimeCheckboxes.forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = isChecked;
                    }
                });
                
                updateSelectAllTimezone();
                updateTimezoneGroupCheckboxes();
            });

            // ì‹œê°„ëŒ€ "í”¼í¬íƒ€ì„" ê·¸ë£¹ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ (ì—…ë°ì´íŠ¸ë¨)
            document.getElementById('selectPeakTime').addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                const peakTimeCheckboxes = [
                    'timezoneJpPrime', 'timezoneInPrime', 'timezoneAuPrime', 'timezoneCnEvening',
                    'timezoneUsWest', 'timezoneCaPrime', 'timezoneDePrime', 'timezoneEsPrime',
                    'timezoneArPrime', 'timezoneSaPrime', 'timezoneRuPrime'
                ];
                
                peakTimeCheckboxes.forEach(id => {
                    const checkbox = document.getElementById(id);
                    if (checkbox) {
                        checkbox.checked = isChecked;
                    }
                });
                
                updateSelectAllTimezone();
                updateTimezoneGroupCheckboxes();
            });

            // ê°œë³„ ì‹œê°„ëŒ€ ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
            const allTimezoneCheckboxes = [
                // ê¸€ë¡œë²Œ & ë²”ìš©
                'timezoneGlobalSweet', 'timezoneShortsPeak', 'timezoneWeekend',
                // ì•„ì‹œì•„-íƒœí‰ì–‘
                'timezoneKrGolden', 'timezoneJpPrime', 'timezoneInPrime', 'timezoneThGolden', 
                'timezoneVnEvening', 'timezoneIdPrime', 'timezoneAuPrime', 'timezoneCnEvening',
                // ë¶ë¯¸
                'timezoneUsEast', 'timezoneUsWest', 'timezoneCaPrime', 'timezoneMxPrime',
                // ìœ ëŸ½
                'timezoneGbPrime', 'timezoneDePrime', 'timezoneFrEvening', 'timezoneEsPrime', 'timezoneItPrime',
                // ë‚¨ë¯¸
                'timezoneBrPrime', 'timezoneArPrime', 'timezoneCoPrime',
                // ì¤‘ë™ & ì•„í”„ë¦¬ì¹´
                'timezoneSaPrime', 'timezoneAePrime', 'timezoneZaPrime', 'timezoneNgPrime', 'timezoneEgPrime',
                // ê¸°íƒ€
                'timezoneRuPrime',
                // í•œêµ­ ì„¸ë¶€
                'timezoneKrLunch', 'timezoneKrNight', 'timezoneKrMorning'
            ];
            
            allTimezoneCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.addEventListener('change', () => {
                        updateSelectAllTimezone();
                        updateTimezoneGroupCheckboxes();
                    });
                }
            });
            
            console.log('âœ… ì‹œê°„ëŒ€ í•„í„° ì´ˆê¸°í™” ì™„ë£Œ:', allTimezoneCheckboxes.length + 'ê°œ ì²´í¬ë°•ìŠ¤');
        }

        // ì‹œê°„ëŒ€ "ëª¨ë‘ ì„ íƒ" ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllTimezone() {
            const allTimezoneCheckboxes = [
                // ê¸€ë¡œë²Œ & ë²”ìš©
                'timezoneGlobalSweet', 'timezoneShortsPeak', 'timezoneWeekend',
                // ì•„ì‹œì•„-íƒœí‰ì–‘
                'timezoneKrGolden', 'timezoneJpPrime', 'timezoneInPrime', 'timezoneThGolden', 
                'timezoneVnEvening', 'timezoneIdPrime', 'timezoneAuPrime', 'timezoneCnEvening',
                // ë¶ë¯¸
                'timezoneUsEast', 'timezoneUsWest', 'timezoneCaPrime', 'timezoneMxPrime',
                // ìœ ëŸ½
                'timezoneGbPrime', 'timezoneDePrime', 'timezoneFrEvening', 'timezoneEsPrime', 'timezoneItPrime',
                // ë‚¨ë¯¸
                'timezoneBrPrime', 'timezoneArPrime', 'timezoneCoPrime',
                // ì¤‘ë™ & ì•„í”„ë¦¬ì¹´
                'timezoneSaPrime', 'timezoneAePrime', 'timezoneZaPrime', 'timezoneNgPrime', 'timezoneEgPrime',
                // ê¸°íƒ€
                'timezoneRuPrime',
                // í•œêµ­ ì„¸ë¶€
                'timezoneKrLunch', 'timezoneKrNight', 'timezoneKrMorning'
            ];
            
            const checkedCount = allTimezoneCheckboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectAllCheckbox = document.getElementById('selectAllTimezone');
            if (checkedCount === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCount === allTimezoneCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        // ì‹œê°„ëŒ€ ê·¸ë£¹ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateTimezoneGroupCheckboxes() {
            const goldenTimeCheckboxes = [
                'timezoneGlobalSweet', 'timezoneShortsPeak', 'timezoneWeekend',
                'timezoneKrGolden', 'timezoneUsEast', 'timezoneGbPrime', 'timezoneBrPrime'
            ];
            const peakTimeCheckboxes = [
                'timezoneJpPrime', 'timezoneInPrime', 'timezoneAuPrime', 'timezoneCnEvening',
                'timezoneUsWest', 'timezoneCaPrime', 'timezoneDePrime', 'timezoneEsPrime',
                'timezoneArPrime', 'timezoneSaPrime', 'timezoneRuPrime'
            ];
            
            // ê³¨ë“ íƒ€ì„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const goldenCheckedCount = goldenTimeCheckboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectGoldenCheckbox = document.getElementById('selectGoldenTime');
            if (goldenCheckedCount === 0) {
                selectGoldenCheckbox.checked = false;
                selectGoldenCheckbox.indeterminate = false;
            } else if (goldenCheckedCount === goldenTimeCheckboxes.length) {
                selectGoldenCheckbox.checked = true;
                selectGoldenCheckbox.indeterminate = false;
            } else {
                selectGoldenCheckbox.checked = false;
                selectGoldenCheckbox.indeterminate = true;
            }
            
            // í”¼í¬íƒ€ì„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const peakCheckedCount = peakTimeCheckboxes.filter(id => {
                const checkbox = document.getElementById(id);
                return checkbox && checkbox.checked;
            }).length;
            
            const selectPeakCheckbox = document.getElementById('selectPeakTime');
            if (peakCheckedCount === 0) {
                selectPeakCheckbox.checked = false;
                selectPeakCheckbox.indeterminate = false;
            } else if (peakCheckedCount === peakTimeCheckboxes.length) {
                selectPeakCheckbox.checked = true;
                selectPeakCheckbox.indeterminate = false;
            } else {
                selectPeakCheckbox.checked = false;
                selectPeakCheckbox.indeterminate = true;
            }
        }
        
        // êµ­ê°€ë³„ ì‹œê°„ëŒ€ ë§¤í•‘
        const countryTimezones = {
            'korea': 'Asia/Seoul',
            'japan': 'Asia/Tokyo', 
            'usa': 'America/New_York',
            'canada': 'America/Toronto',
            'uk': 'Europe/London',
            'germany': 'Europe/Berlin',
            'france': 'Europe/Paris',
            'spain': 'Europe/Madrid',
            'italy': 'Europe/Rome',
            'brazil': 'America/Sao_Paulo',
            'argentina': 'America/Buenos_Aires',
            'colombia': 'America/Bogota',
            'mexico': 'America/Mexico_City',
            'india': 'Asia/Kolkata',
            'thailand': 'Asia/Bangkok',
            'vietnam': 'Asia/Ho_Chi_Minh',
            'indonesia': 'Asia/Jakarta',
            'australia': 'Australia/Sydney',
            'china': 'Asia/Shanghai',
            'russia': 'Europe/Moscow',
            'saudi': 'Asia/Riyadh',
            'uae': 'Asia/Dubai',
            'egypt': 'Africa/Cairo',
            'nigeria': 'Africa/Lagos',
            'southafrica': 'Africa/Johannesburg',
            'worldwide': 'UTC'
        };
        
        // êµ­ê°€ë³„ êµ­ê°€ ì½”ë“œ ë§¤í•‘
        const countryCodeMap = {
            'korea': 'KR',
            'japan': 'JP', 
            'usa': 'US',
            'canada': 'CA',
            'uk': 'GB',
            'germany': 'DE',
            'france': 'FR',
            'spain': 'ES',
            'italy': 'IT',
            'brazil': 'BR',
            'argentina': 'AR',
            'colombia': 'CO',
            'mexico': 'MX',
            'india': 'IN',
            'thailand': 'TH',
            'vietnam': 'VN',
            'indonesia': 'ID',
            'australia': 'AU',
            'china': 'CN',
            'russia': 'RU',
            'saudi': 'SA',
            'uae': 'AE',
            'egypt': 'EG',
            'nigeria': 'NG',
            'southafrica': 'ZA',
            'worldwide': 'GL'
        };
        
        // ì„ íƒëœ êµ­ê°€ ê°€ì ¸ì˜¤ê¸°
        function getSelectedCountry() {
            const selectedCountries = document.querySelectorAll('input[name="countries"]:checked');
            if (selectedCountries.length > 0) {
                return selectedCountries[0].value; // ì²« ë²ˆì§¸ ì„ íƒëœ êµ­ê°€
            }
            return 'korea'; // ê¸°ë³¸ê°’
        }
        
        // ë–¡ìƒë¥  íŒë‹¨ í•¨ìˆ˜
        function getViralRateClass(hours, minutes, dayOfWeek, country) {
            // ì‹œê°„ì„ ë¶„ ë‹¨ìœ„ë¡œ ë³€í™˜
            const timeInMinutes = hours * 60 + minutes;
            
            // ì£¼ë§ ì—¬ë¶€ í™•ì¸ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
            
            // ë–¡ìƒë¥  45% ì´ìƒ: ìµœê³  í”¼í¬ ì‹œê°„ëŒ€
            // ê·¸ë¡œë²Œ ìŠ¤ìœ—ìŠ¤íŒŸ (14:00-16:00 EST) - 42%
            // ì‡¼ì¸  í”¼í¬íƒ€ì„ (07:00-09:00, 12:00-13:00, 18:00-20:00) - 45%
            if (
                (timeInMinutes >= 420 && timeInMinutes <= 540) ||  // 07:00-09:00 (ì‡¼ì¸  í”¼í¬)
                (timeInMinutes >= 720 && timeInMinutes <= 780) ||  // 12:00-13:00 (ì‡¼ì¸  í”¼í¬)
                (timeInMinutes >= 1080 && timeInMinutes <= 1200)   // 18:00-20:00 (ì‡¼ì¸  í”¼í¬)
            ) {
                return 'viral-45';
            }
            
            // ë–¡ìƒë¥  40% ì´ìƒ: ê·¸ë¡œë²Œ ìŠ¤ìœ—ìŠ¤íŒŸ
            if (timeInMinutes >= 840 && timeInMinutes <= 960) { // 14:00-16:00 (ê·¸ë¡œë²Œ ìŠ¤ìœ—ìŠ¤íŒŸ)
                return 'viral-40';
            }
            
            // ë–¡ìƒë¥  30% ì´ìƒ: í•œêµ­ ê³¨ë“ íƒ€ì„, ë¯¸êµ­ ë™ë¶€ í”„ë¼ì„
            if (
                (country === 'korea' && timeInMinutes >= 1080 && timeInMinutes <= 1380) || // 18:00-23:00 KST (í•œêµ­ ê³¨ë“ íƒ€ì„ - 35%)
                (country === 'usa' && timeInMinutes >= 1140 && timeInMinutes <= 1380)      // 19:00-23:00 EST (ë¯¸êµ­ ë™ë¶€ í”„ë¼ì„ - 28%)
            ) {
                return 'viral-30';
            }
            
            // ë–¡ìƒë¥  20% ì´ìƒ: ê¸°íƒ€ ê³¨ë“ íƒ€ì„ë“¤
            if (
                (country === 'korea' && timeInMinutes >= 660 && timeInMinutes <= 840) ||  // 11:00-14:00 KST (í•œêµ­ ì ì‹¬ í”¼í¬ - 22%)
                (isWeekend && timeInMinutes >= 840 && timeInMinutes <= 1080) ||           // ì£¼ë§ 14:00-18:00 (ì£¼ë§ ì˜¤í›„ íƒ€ì„ - 25%)
                (country === 'japan' && timeInMinutes >= 1140 && timeInMinutes <= 1380)   // 19:00-23:00 JST (ì¼ë³¸ í”„ë¼ì„íƒ€ì„ - 24%)
            ) {
                return 'viral-20';
            }
            
            // ê¸°ë³¸ê°’ (ë–¡ìƒë¥  20% ë¯¸ë§Œ)
            return '';
        }
        
        // í˜„ì§€ì‹œê°„ í¬ë§·íŒ…
        function formatLocalTime(dateObj, country) {
            const timezone = countryTimezones[country] || 'UTC';
            const countryCode = countryCodeMap[country] || 'GL';
            
            // í˜„ì§€ì‹œê°„ìœ¼ë¡œ ë³€í™˜
            const localDate = new Date(dateObj.toLocaleString("en-US", {timeZone: timezone}));
            
            // 1ì¤„: ì—°ì›”ì¼
            const year = localDate.getFullYear();
            const month = String(localDate.getMonth() + 1).padStart(2, '0');
            const day = String(localDate.getDate()).padStart(2, '0');
            const dateStr = `${year}.${month}.${day}`;
            
            // 2ì¤„: êµ­ê°€ì½”ë“œ + ìš”ì¼
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const dayName = dayNames[localDate.getDay()];
            const countryDayStr = `${countryCode} ${dayName}`;
            
            // 3ì¤„: ì‹œë¶„ì´ˆ (AM/PM í˜•ì‹)
            let hours = localDate.getHours();
            const minutes = String(localDate.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12;
            const finalHours = displayHours === 0 ? 12 : displayHours;
            const timeStr = `${ampm} ${finalHours}:${minutes}`;
            
            // ë–¡ìƒë¥  í´ë˜ìŠ¤ ê²°ì •
            const viralClass = getViralRateClass(hours, localDate.getMinutes(), localDate.getDay(), country);
            
            return {
                date: dateStr,
                countryDay: countryDayStr,
                time: timeStr,
                viralClass: viralClass
            };
        }
        
        // í•œêµ­ì‹œê°„ í¬ë§·íŒ…
        function formatKoreaTime(dateObj) {
            // í•œêµ­ì‹œê°„(UTC+9)ìœ¼ë¡œ ë³€í™˜
            const koreaDate = new Date(dateObj.toLocaleString("en-US", {timeZone: 'Asia/Seoul'}));
            
            // 1ì¤„: ì—°ì›”ì¼
            const year = koreaDate.getFullYear();
            const month = String(koreaDate.getMonth() + 1).padStart(2, '0');
            const day = String(koreaDate.getDate()).padStart(2, '0');
            const dateStr = `${year}.${month}.${day}`;
            
            // 2ì¤„: Ko + ìš”ì¼
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const dayName = dayNames[koreaDate.getDay()];
            const countryDayStr = `Ko ${dayName}`;
            
            // 3ì¤„: ì‹œë¶„ì´ˆ (ì˜¤ì „/ì˜¤í›„ í˜•ì‹)
            let hours = koreaDate.getHours();
            const minutes = String(koreaDate.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
            const displayHours = hours % 12;
            const finalHours = displayHours === 0 ? 12 : displayHours;
            const timeStr = `${ampm} ${finalHours}:${minutes}`;
            
            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ ë–¡ìƒë¥  í´ë˜ìŠ¤ ê²°ì •
            const viralClass = getViralRateClass(hours, koreaDate.getMinutes(), koreaDate.getDay(), 'korea');
            
            return {
                date: dateStr,
                countryDay: countryDayStr,
                time: timeStr,
                viralClass: viralClass
            };
        }
        
        // ì¡°íšŒìˆ˜ í¬ë§·íŒ…
        function formatViewCount(viewCount) {
            const num = parseInt(viewCount) || 0;
            if (num >= 100000000) { // 1ì–µ ì´ìƒ
                return Math.floor(num / 100000000) + 'ì–µ';
            } else if (num >= 10000000) { // 1ì²œë§Œ ì´ìƒ
                return Math.floor(num / 10000000) + 'ì²œë§Œ';
            } else if (num >= 1000000) { // 100ë§Œ ì´ìƒ
                return Math.floor(num / 10000) + 'ë§Œ';
            } else if (num >= 10000) { // 1ë§Œ ì´ìƒ
                return Math.floor(num / 10000) + 'ë§Œ';
            } else if (num >= 1000) { // 1ì²œ ì´ìƒ
                return Math.floor(num / 1000) + 'K';
            } else {
                return num.toString();
            }
        }
        
        // êµ¬ë…ììˆ˜ í¬ë§·íŒ… (ë§Œ ë‹¨ìœ„)
        function formatSubscriberCount(subscriberCount) {
            const num = parseInt(subscriberCount) || 0;
            if (num >= 100000000) { // 1ì–µ ì´ìƒ
                return Math.floor(num / 100000000) + 'ì–µ';
            } else if (num >= 10000) { // 1ë§Œ ì´ìƒ
                return Math.floor(num / 10000) + 'ë§Œ';
            } else if (num >= 1000) { // 1ì²œ ì´ìƒ
                return Math.floor(num / 1000) + 'K';
            } else {
                return num.toString();
            }
        }
        
        // ë™ì˜ìƒ ì‹œê°„ í¬ë§·íŒ…
        function formatDuration(durationSeconds) {
            const seconds = parseInt(durationSeconds) || 0;
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const remainingSeconds = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
            } else {
                return `${minutes}:${String(remainingSeconds).padStart(2, '0')}`;
            }
        }
        
        // ë™ì˜ìƒ URL ì—´ê¸° ë° ë³µì‚¬
        function openVideoWithCopy(url) {
            // ìƒˆ íƒ­ì—ì„œ ë™ì˜ìƒ ì—´ê¸°
            window.open(url, '_blank');
            
            // URLì„ í´ë¦½ë³´ë“œì— ë³µì‚¬
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(() => {
                    console.log('URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤:', url);
                }).catch(err => {
                    console.error('URL ë³µì‚¬ ì‹¤íŒ¨:', err);
                    fallbackCopyToClipboard(url);
                });
            } else {
                // êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›
                fallbackCopyToClipboard(url);
            }
        }
        
        // í´ë¦½ë³´ë“œ ë³µì‚¬ fallback í•¨ìˆ˜
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                console.log('URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ (fallback):', text);
            } catch (err) {
                console.error('Fallback ë³µì‚¬ë„ ì‹¤íŒ¨:', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        // UI ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function showLoading() {
            document.getElementById('loadingIndicator').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loadingIndicator').style.display = 'none';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = message;
            errorDiv.style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        function showResults() {
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('downloadExcelBtn').style.display = 'flex';
        }
        
        function hideResults() {
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('downloadExcelBtn').style.display = 'none';
        }
        
        function showInfo(message) {
            // ê°„ë‹¨í•œ ì •ë³´ ë©”ì‹œì§€ í‘œì‹œ (í•„ìš”ì‹œ êµ¬í˜„)
            console.log('â„¹ï¸ ì •ë³´:', message);
        }
        
        // í˜ì´ì§€ ë³€ê²½ í•¨ìˆ˜
        function changePage(page) {
            if (page < 1 || page > Math.ceil(searchResults.length / itemsPerPage)) return;
            currentPage = page;
            renderResults();
        }
        
        // ì •ë ¬ í—¤ë” ì—…ë°ì´íŠ¸
        function updateSortHeaders() {
            // ëª¨ë“  í—¤ë”ì—ì„œ ì •ë ¬ í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.results-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            // í˜„ì¬ ì •ë ¬ ì»¬ëŸ¼ì— í´ë˜ìŠ¤ ì¶”ê°€
            const currentHeader = document.querySelector(`[data-sort="${sortColumn}"]`);
            if (currentHeader) {
                currentHeader.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
            }
        }
        
        // í…Œì´ë¸” í—¤ë” í´ë¦­ ì´ë²¤íŠ¸ (ì •ë ¬)
        function initializeSorting() {
            document.querySelectorAll('.results-table th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.getAttribute('data-sort');
                    if (sortColumn === column) {
                        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortColumn = column;
                        sortDirection = 'desc';
                    }
                    sortResults();
                    renderResults();
                });
            });
        }
        
        // Excel ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadExcel() {
            try {
                const button = document.getElementById('downloadExcelBtn');
                button.disabled = true;
                button.textContent = 'ğŸ“Š ìƒì„±ì¤‘...';
                
                const response = await fetch('/api/download-excel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: searchResults })
                });
                
                if (!response.ok) {
                    throw new Error('Excel ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `youtube_search_results_${new Date().toISOString().slice(0, 10)}.xlsx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
            } catch (error) {
                console.error('Excel ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('Excel ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                const button = document.getElementById('downloadExcelBtn');
                button.disabled = false;
                button.textContent = 'ğŸ“Š';
            }
        }
        
        // ì´ˆê¸°í™” ì‹œ ì •ë ¬ ì´ë²¤íŠ¸ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', () => {
            initializeSorting();
        });
        
        // ì¤‘ë³µëœ DOMContentLoaded ì´ë²¤íŠ¸ ì œê±°ë¨ (í†µí•©ëœ initializeApp í•¨ìˆ˜ë¡œ ëŒ€ì²´)
    </script>
    

</body>
</html>